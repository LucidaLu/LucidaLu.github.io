<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">

<link href="//cdn.staticfile.org/KaTeX/0.7.1/katex.min.css"rel="stylesheet">











<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/luz.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/luz.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/luz.png?v=6.3.0">










<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="It&apos;s been a while.">
<meta property="og:type" content="website">
<meta property="og:title" content="Hey,Lucida is back.">
<meta property="og:url" content="http://lucida.site/page/2/index.html">
<meta property="og:site_name" content="Hey,Lucida is back.">
<meta property="og:description" content="It&apos;s been a while.">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hey,Lucida is back.">
<meta name="twitter:description" content="It&apos;s been a while.">






  <link rel="canonical" href="http://lucida.site/page/2/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Hey,Lucida is back.</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hey,Lucida is back.</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">CS</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-friends">
    <a href="/friends/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />friends</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lucida.site/poj3680/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucida">
      <meta itemprop="description" content="It's been a while.">
      <meta itemprop="image" content="/images/luz.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey,Lucida is back.">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/poj3680/" itemprop="url">
                  poj3680 Intervals
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-06-10 15:44:11" itemprop="dateCreated datePublished" datetime="2017-06-10T15:44:11+08:00">2017-06-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-06-17 18:00:39" itemprop="dateModified" datetime="2018-06-17T18:00:39+08:00">2018-06-17</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Link"><a href="#Link" class="headerlink" title="Link"></a><a href="http://poj.org/problem?id=3680" target="_blank" rel="noopener">Link</a></h1><p>似乎是白书某个角落的一道思考题？？</p>
<h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>把区间离散化成2n个点</p>
<p>连边</p>
<p><code>S-&gt;1 &lt;K,0&gt;</code></p>
<p><code>2n-&gt;T &lt;K,0&gt;</code></p>
<p><code>i-&gt;i+1 &lt;inf,0&gt;</code></p>
<p><code>l[i]-&gt;r[i] &lt;1,w[i]&gt;</code></p>
<p>然后跑最大费用最大流。</p>
<p>因为一条增广路互不相交，所以可以尽情走，走出K条就完成了任务。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lucida.site/lyoj323/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucida">
      <meta itemprop="description" content="It's been a while.">
      <meta itemprop="image" content="/images/luz.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey,Lucida is back.">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/lyoj323/" itemprop="url">
                  Delight for a Cat
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-06-10 15:35:10" itemprop="dateCreated datePublished" datetime="2017-06-10T15:35:10+08:00">2017-06-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-06-18 18:23:51" itemprop="dateModified" datetime="2018-06-18T18:23:51+08:00">2018-06-18</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Link"><a href="#Link" class="headerlink" title="Link"></a><a href="https://ly.men.ci/problem/323" target="_blank" rel="noopener">Link</a></h1><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>默认每天都碎觉，每长度为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.07153em;">K</span></span></span></span>的区间，可以把<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="31.87ex" height="2.843ex" style="vertical-align: -0.838ex;" viewbox="0 -863.1 13721.7 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg">
<defs>
<path stroke-width="1" id="E1-MJMAIN-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"/>
<path stroke-width="1" id="E1-MJMATHI-6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"/>
<path stroke-width="1" id="E1-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/>
<path stroke-width="1" id="E1-MJMAIN-6D" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"/>
<path stroke-width="1" id="E1-MJMAIN-69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z"/>
<path stroke-width="1" id="E1-MJMAIN-6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"/>
<path stroke-width="1" id="E1-MJMAIN-45" d="M128 619Q121 626 117 628T101 631T58 634H25V680H597V676Q599 670 611 560T625 444V440H585V444Q584 447 582 465Q578 500 570 526T553 571T528 601T498 619T457 629T411 633T353 634Q266 634 251 633T233 622Q233 622 233 621Q232 619 232 497V376H286Q359 378 377 385Q413 401 416 469Q416 471 416 473V493H456V213H416V233Q415 268 408 288T383 317T349 328T297 330Q290 330 286 330H232V196V114Q232 57 237 52Q243 47 289 47H340H391Q428 47 452 50T505 62T552 92T584 146Q594 172 599 200T607 247T612 270V273H652V270Q651 267 632 137T610 3V0H25V46H58Q100 47 109 49T128 61V619Z"/>
<path stroke-width="1" id="E1-MJMAIN-61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z"/>
<path stroke-width="1" id="E1-MJMAIN-74" d="M27 422Q80 426 109 478T141 600V615H181V431H316V385H181V241Q182 116 182 100T189 68Q203 29 238 29Q282 29 292 100Q293 108 293 146V181H333V146V134Q333 57 291 17Q264 -10 221 -10Q187 -10 162 2T124 33T105 68T98 100Q97 107 97 248V385H18V422H27Z"/>
<path stroke-width="1" id="E1-MJMAIN-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"/>
<path stroke-width="1" id="E1-MJMATHI-72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/>
<path stroke-width="1" id="E1-MJMATHI-4B" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"/>
<path stroke-width="1" id="E1-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/>
<path stroke-width="1" id="E1-MJMAIN-53" d="M55 507Q55 590 112 647T243 704H257Q342 704 405 641L426 672Q431 679 436 687T446 700L449 704Q450 704 453 704T459 705H463Q466 705 472 699V462L466 456H448Q437 456 435 459T430 479Q413 605 329 646Q292 662 254 662Q201 662 168 626T135 542Q135 508 152 480T200 435Q210 431 286 412T370 389Q427 367 463 314T500 191Q500 110 448 45T301 -21Q245 -21 201 -4T140 27L122 41Q118 36 107 21T87 -7T78 -21Q76 -22 68 -22H64Q61 -22 55 -16V101Q55 220 56 222Q58 227 76 227H89Q95 221 95 214Q95 182 105 151T139 90T205 42T305 24Q352 24 386 62T420 155Q420 198 398 233T340 281Q284 295 266 300Q261 301 239 306T206 314T174 325T141 343T112 367T85 402Q55 451 55 507Z"/>
<path stroke-width="1" id="E1-MJMAIN-6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"/>
<path stroke-width="1" id="E1-MJMAIN-65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z"/>
<path stroke-width="1" id="E1-MJMAIN-70" d="M36 -148H50Q89 -148 97 -134V-126Q97 -119 97 -107T97 -77T98 -38T98 6T98 55T98 106Q98 140 98 177T98 243T98 296T97 335T97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 61 434T98 436Q115 437 135 438T165 441T176 442H179V416L180 390L188 397Q247 441 326 441Q407 441 464 377T522 216Q522 115 457 52T310 -11Q242 -11 190 33L182 40V-45V-101Q182 -128 184 -134T195 -145Q216 -148 244 -148H260V-194H252L228 -193Q205 -192 178 -192T140 -191Q37 -191 28 -194H20V-148H36ZM424 218Q424 292 390 347T305 402Q234 402 182 337V98Q222 26 294 26Q345 26 384 80T424 218Z"/>
<path stroke-width="1" id="E1-MJMAIN-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)">
 <use xlink:href="#E1-MJMAIN-5B" x="0" y="0"/>
 <use xlink:href="#E1-MJMATHI-6C" x="278" y="0"/>
 <use xlink:href="#E1-MJMAIN-3D" x="854" y="0"/>
<g transform="translate(1911,0)">
 <use xlink:href="#E1-MJMAIN-6D" x="0" y="0"/>
 <use xlink:href="#E1-MJMAIN-69" x="833" y="0"/>
 <use xlink:href="#E1-MJMAIN-6E" x="1112" y="0"/>
 <use xlink:href="#E1-MJMAIN-45" x="1668" y="0"/>
 <use xlink:href="#E1-MJMAIN-61" x="2350" y="0"/>
 <use xlink:href="#E1-MJMAIN-74" x="2850" y="0"/>
</g>
 <use xlink:href="#E1-MJMAIN-2C" x="5151" y="0"/>
 <use xlink:href="#E1-MJMATHI-72" x="5596" y="0"/>
 <use xlink:href="#E1-MJMAIN-3D" x="6325" y="0"/>
 <use xlink:href="#E1-MJMATHI-4B" x="7381" y="0"/>
 <use xlink:href="#E1-MJMAIN-2212" x="8493" y="0"/>
<g transform="translate(9494,0)">
 <use xlink:href="#E1-MJMAIN-6D" x="0" y="0"/>
 <use xlink:href="#E1-MJMAIN-69" x="833" y="0"/>
 <use xlink:href="#E1-MJMAIN-6E" x="1112" y="0"/>
 <use xlink:href="#E1-MJMAIN-53" x="1668" y="0"/>
 <use xlink:href="#E1-MJMAIN-6C" x="2225" y="0"/>
 <use xlink:href="#E1-MJMAIN-65" x="2503" y="0"/>
 <use xlink:href="#E1-MJMAIN-65" x="2948" y="0"/>
 <use xlink:href="#E1-MJMAIN-70" x="3392" y="0"/>
</g>
 <use xlink:href="#E1-MJMAIN-5D" x="13443" y="0"/>
</g>
</svg>天转化成歘饭。。</p>
<p>修改一个点<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.65952em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span>，可以影响的区间的右端点的区间为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>i</mi><mo separator="true">,</mo><mi>i</mi><mo>+</mo><mi>K</mi><mo>−</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">[i,i+K-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord mathit">i</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span></span>。</p>
<p>现在问题转化成有<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>−</mo><mi>K</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-K+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mbin">+</span><span class="mord mathrm">1</span></span></span></span>点和<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span>个区间，选择一个区间会产生相应获利，在每个点有<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>l</mi><mo separator="true">,</mo><mi>r</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[l,r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span>个区间覆盖着的前提下，获利尽量大。</p>
<p>建图
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">S&apos;-&gt;S &lt;r,0&gt;</span><br><span class="line">S-&gt;1..k &lt;1,0&gt;</span><br><span class="line">i-&gt;i+1 &lt;r-l,0&gt;</span><br><span class="line">i-&gt;i+k &lt;1,s[i]-e[i]&gt;</span><br></pre></td></tr></table></figure></p>
<p>对于<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>≥</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">i\ge K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.8193em;vertical-align:-0.13597em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span><span class="mrel">≥</span><span class="mord mathit" style="margin-right:0.07153em;">K</span></span></span></span>,一个<code>i-&gt;i+1</code>的剖面，流量是<code>r</code>。把不改变的天数限制在<code>[0,r-l]</code>，那么改变的天数就满足了限制。</p>
<p>对于<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>&lt;</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">i&lt;K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span><span class="mrel">&lt;</span><span class="mord mathit" style="margin-right:0.07153em;">K</span></span></span></span>，?</p>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Istream</span> &#123;</span></span><br><span class="line">	Istream() &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></span><br><span class="line">		freopen(<span class="string">"input"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">		std::string fileName(__FILE__),name=fileName.substr(0,fileName.find('.'));</span><br><span class="line">		freopen((name+<span class="string">".in"</span>).c_str(),<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">		freopen((name+<span class="string">".out"</span>).c_str(),<span class="string">"w"</span>,<span class="built_in">stdout</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; </span></span><br><span class="line"><span class="class">	<span class="title">Istream</span> &amp;<span class="title">operator</span> &gt;&gt;(<span class="title">T</span> &amp;<span class="title">x</span>) &#123;</span></span><br><span class="line">		<span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">static</span> <span class="keyword">bool</span> neg;</span><br><span class="line">		<span class="keyword">for</span>(ch=neg=<span class="number">0</span>;ch&lt;<span class="string">'0'</span> || <span class="string">'9'</span>&lt;ch;neg|=ch==<span class="string">'-'</span>,ch=getchar());</span><br><span class="line">		<span class="keyword">for</span>(x=<span class="number">0</span>;<span class="string">'0'</span>&lt;=ch &amp;&amp; ch&lt;=<span class="string">'9'</span>;(x*=<span class="number">10</span>)+=ch-<span class="string">'0'</span>,ch=getchar());</span><br><span class="line">		x=neg?-x:x;</span><br><span class="line">		<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;is;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ostream</span> &#123;</span></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class">	<span class="title">Ostream</span> &amp;<span class="title">operator</span> &lt;&lt;(T x) &#123;</span></span><br><span class="line"><span class="class">		x&lt;0 &amp;&amp; (putchar('-'),x=-x);</span></span><br><span class="line"><span class="class">		static char stack[233];static int top;</span></span><br><span class="line"><span class="class">		for(top=0;x;stack[++top]=x%10+'0',x/=10);</span></span><br><span class="line"><span class="class">		for(top==0 &amp;&amp; (stack[top=1]='0');top;putchar(stack[top--]));</span></span><br><span class="line"><span class="class">		return *this;</span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">	Ostream &amp;operator &lt;&lt;(char ch) &#123;</span></span><br><span class="line"><span class="class">		putchar(ch);</span></span><br><span class="line"><span class="class">		return *this;</span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">&#125;os;</span></span><br><span class="line"><span class="class">#define int64 long long</span></span><br><span class="line"><span class="class">const int MAXN=1000+11;</span></span><br><span class="line"><span class="class">template &lt;class T&gt; inline</span></span><br><span class="line"><span class="class">bool chkmx(T &amp;a,T const &amp;b) &#123;</span></span><br><span class="line"><span class="class">	return a&lt;b?a=b,1:0;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class">template &lt;class T&gt; inline</span></span><br><span class="line"><span class="class">bool chkmn(T &amp;a,T const &amp;b) &#123;</span></span><br><span class="line"><span class="class">	return a&gt;b?a=b,1:0;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class">namespace MCMF &#123;</span></span><br><span class="line"><span class="class">const int INF=0x1f1f1f1f;</span></span><br><span class="line"><span class="class">const int64 INF64=0x1f1f1f1f1f1f1f1fll;</span></span><br><span class="line"><span class="class">struct Edge &#123;</span></span><br><span class="line"><span class="class">	int to,v,cap,cost;Edge *pre,*rev;</span></span><br><span class="line"><span class="class">	Edge(int to,int cap,int cost,Edge *pre):to(to),v(0),cap(cap),cost(cost),pre(pre),rev(0) &#123;&#125;</span></span><br><span class="line"><span class="class">&#125;*G[MAXN],*preE[MAXN];</span></span><br><span class="line"><span class="class">int S,T,n;</span></span><br><span class="line"><span class="class">int *Adde(int f,int t,int cap,int cost) &#123;</span></span><br><span class="line"><span class="class">	G[f]=new Edge(t,cap,cost,G[f]);</span></span><br><span class="line"><span class="class">	G[t]=new Edge(f,0,-cost,G[t]);</span></span><br><span class="line"><span class="class">	G[f]-&gt;rev=G[t];G[t]-&gt;rev=G[f];</span></span><br><span class="line"><span class="class">	return &amp;G[f]-&gt;v;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class">int Aug() &#123;</span></span><br><span class="line"><span class="class">	int minf=INF;</span></span><br><span class="line"><span class="class">	for(Edge *e=preE[T];e;e=preE[e-&gt;rev-&gt;<span class="title">to</span>]) &#123;</span></span><br><span class="line">		chkmn(minf,e-&gt;cap-e-&gt;v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(Edge *e=preE[T];e;e=preE[e-&gt;rev-&gt;to]) &#123;</span><br><span class="line">		e-&gt;v+=minf;</span><br><span class="line">		e-&gt;rev-&gt;v-=minf;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> minf;</span><br><span class="line">&#125;</span><br><span class="line">int64 dist[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Path</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">bool</span> inq[MAXN];</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> Q[MAXN],he,ta;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		dist[i]=-INF64;</span><br><span class="line">		inq[i]=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//队列有n+1个位置</span></span><br><span class="line">	dist[S]=<span class="number">0</span>;</span><br><span class="line">	Q[he=<span class="number">0</span>]=S;inq[S]=<span class="number">1</span>;ta=<span class="number">1</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> succ(i) ((i)==n?0:(i)+1)</span></span><br><span class="line">	<span class="keyword">while</span>(he!=ta) &#123;</span><br><span class="line">		<span class="keyword">int</span> pos=Q[he];he=succ(he);inq[pos]=<span class="number">0</span>;<span class="comment">//丢人..</span></span><br><span class="line">		<span class="keyword">for</span>(Edge *e=G[pos];e;e=e-&gt;pre) <span class="keyword">if</span>(e-&gt;cap&gt;e-&gt;v) &#123;</span><br><span class="line">			<span class="keyword">int</span> u=e-&gt;to;</span><br><span class="line">			<span class="keyword">if</span>(chkmx(dist[u],dist[pos]+e-&gt;cost)) &#123;</span><br><span class="line">				preE[u]=e;</span><br><span class="line">				<span class="keyword">if</span>(!inq[u]) &#123;</span><br><span class="line">					inq[u]=<span class="number">1</span>;</span><br><span class="line">					Q[ta]=u;</span><br><span class="line">					ta=succ(ta);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dist[T]!=-INF64;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">int64 <span class="title">Run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	int64 cost=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> flow=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(Path()) &#123;</span><br><span class="line">		<span class="keyword">int</span> f=Aug();</span><br><span class="line">		flow+=f;</span><br><span class="line">		cost+=dist[T]*f;</span><br><span class="line">		<span class="comment">//os&lt;&lt;cost&lt;&lt;'\n';</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> cost;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*namespace MCMF*/</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> js[MAXN],je[MAXN],w[MAXN];</span><br><span class="line">	<span class="keyword">int</span> n,K,mSleep,mEat;</span><br><span class="line">	is&gt;&gt;n&gt;&gt;K&gt;&gt;mSleep&gt;&gt;mEat;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;is&gt;&gt;js[i++]);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;is&gt;&gt;je[i++]);</span><br><span class="line">	int64 sumjs=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		sumjs+=js[i];</span><br><span class="line">		w[i]=je[i]-js[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> *flow[MAXN];</span><br><span class="line">	<span class="keyword">int</span> limL=mEat,limR=K-mSleep;</span><br><span class="line">	<span class="keyword">int</span> SS=MCMF::S=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> T=MCMF::T=n+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> S=n+<span class="number">2</span>;</span><br><span class="line">	MCMF::n=n+<span class="number">3</span>;</span><br><span class="line">	<span class="comment">//--K;</span></span><br><span class="line">	MCMF::Adde(SS,S,limR,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=K;++i) &#123;</span><br><span class="line">		MCMF::Adde(S,i,<span class="number">0x1f1f1f1f</span>,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		MCMF::Adde(i,i+<span class="number">1</span>,limR-limL,<span class="number">0</span>);</span><br><span class="line">		flow[i]=MCMF::Adde(i,<span class="built_in">std</span>::min(i+K,T),<span class="number">1</span>,w[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	os&lt;&lt;sumjs+MCMF::Run()&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		os&lt;&lt;(*flow[i]?<span class="string">'E'</span>:<span class="string">'S'</span>);</span><br><span class="line">	&#125;os&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lucida.site/yist/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucida">
      <meta itemprop="description" content="It's been a while.">
      <meta itemprop="image" content="/images/luz.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey,Lucida is back.">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/yist/" itemprop="url">
                  yist
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-06-09 10:14:09" itemprop="dateCreated datePublished" datetime="2017-06-09T10:14:09+08:00">2017-06-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-06-18 18:23:51" itemprop="dateModified" datetime="2018-06-18T18:23:51+08:00">2018-06-18</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>真<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>⋅</mo></mrow><annotation encoding="application/x-tex">\cdot</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.44445em;"></span><span class="strut bottom" style="height:0.44445em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord">⋅</span></span></span></span>对计数一窍不通。</p>
<h1 id="Link"><a href="#Link" class="headerlink" title="Link"></a><a href="https://ly.men.ci/problem/309" target="_blank" rel="noopener">Link</a></h1><p>同样的题，人家写20行就搞定，我写120行依然出问题。</p>
<h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>分类。
可以分成<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo>)</mo><mo>+</mo><mn>3</mn><mi>d</mi></mrow><annotation encoding="application/x-tex">(a+b+c)+3d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathit">a</span><span class="mbin">+</span><span class="mord mathit">b</span><span class="mbin">+</span><span class="mord mathit">c</span><span class="mclose">)</span><span class="mbin">+</span><span class="mord mathrm">3</span><span class="mord mathit">d</span></span></span></span>或者<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>a</mi><mo>+</mo><mi>d</mi><mo>)</mo><mo>+</mo><mo>(</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo>)</mo><mo>+</mo><mn>2</mn><mi>e</mi></mrow><annotation encoding="application/x-tex">(a+d)+(b+c)+2e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathit">a</span><span class="mbin">+</span><span class="mord mathit">d</span><span class="mclose">)</span><span class="mbin">+</span><span class="mopen">(</span><span class="mord mathit">b</span><span class="mbin">+</span><span class="mord mathit">c</span><span class="mclose">)</span><span class="mbin">+</span><span class="mord mathrm">2</span><span class="mord mathit">e</span></span></span></span></p>
<p>第一种情况，枚举<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">c</span></span></span></span>，枚举<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">d</span></span></span></span>，维护一个数组找<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi><mo>=</mo><mi>d</mi><mo>−</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">a+b=d-c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit">a</span><span class="mbin">+</span><span class="mord mathit">b</span><span class="mrel">=</span><span class="mord mathit">d</span><span class="mbin">−</span><span class="mord mathit">c</span></span></span></span>的方案数</p>
<p>第二种情况，有<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mo>&lt;</mo><mi>b</mi><mo>&lt;</mo><mi>c</mi><mo>&lt;</mo><mi>d</mi><mo separator="true">,</mo><mi>a</mi><mo>&lt;</mo><mi>b</mi><mo>=</mo><mi>c</mi><mo>&lt;</mo><mi>d</mi><mo separator="true">,</mo><mi>a</mi><mo>=</mo><mi>b</mi><mo>&lt;</mo><mi>c</mi><mo>=</mo><mi>d</mi><mo separator="true">,</mo><mi>a</mi><mo>=</mo><mi>b</mi><mo>=</mo><mi>c</mi><mo>=</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">a&lt;b&lt;c&lt;d,a&lt;b=c&lt;d,a=b&lt;c=d,a=b=c=d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">a</span><span class="mrel">&lt;</span><span class="mord mathit">b</span><span class="mrel">&lt;</span><span class="mord mathit">c</span><span class="mrel">&lt;</span><span class="mord mathit">d</span><span class="mpunct">,</span><span class="mord mathit">a</span><span class="mrel">&lt;</span><span class="mord mathit">b</span><span class="mrel">=</span><span class="mord mathit">c</span><span class="mrel">&lt;</span><span class="mord mathit">d</span><span class="mpunct">,</span><span class="mord mathit">a</span><span class="mrel">=</span><span class="mord mathit">b</span><span class="mrel">&lt;</span><span class="mord mathit">c</span><span class="mrel">=</span><span class="mord mathit">d</span><span class="mpunct">,</span><span class="mord mathit">a</span><span class="mrel">=</span><span class="mord mathit">b</span><span class="mrel">=</span><span class="mord mathit">c</span><span class="mrel">=</span><span class="mord mathit">d</span></span></span></span>四种。要分别处理，并且添加一个限制(比如限定当前选择的是最大的)确保不重复。</p>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Istream</span> &#123;</span></span><br><span class="line">	Istream() &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></span><br><span class="line">		freopen(<span class="string">"input"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">		std::string fileName(__FILE__),name=fileName.substr(0,fileName.find('.'));</span><br><span class="line">		freopen((name+<span class="string">".in"</span>).c_str(),<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">		freopen((name+<span class="string">".out"</span>).c_str(),<span class="string">"w"</span>,<span class="built_in">stdout</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; </span></span><br><span class="line"><span class="class">	<span class="title">Istream</span> &amp;<span class="title">operator</span> &gt;&gt;(<span class="title">T</span> &amp;<span class="title">x</span>) &#123;</span></span><br><span class="line">		<span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">static</span> <span class="keyword">bool</span> neg;</span><br><span class="line">		<span class="keyword">for</span>(ch=neg=<span class="number">0</span>;ch&lt;<span class="string">'0'</span> || <span class="string">'9'</span>&lt;ch;neg|=ch==<span class="string">'-'</span>,ch=getchar());</span><br><span class="line">		<span class="keyword">for</span>(x=<span class="number">0</span>;<span class="string">'0'</span>&lt;=ch &amp;&amp; ch&lt;=<span class="string">'9'</span>;(x*=<span class="number">10</span>)+=ch-<span class="string">'0'</span>,ch=getchar());</span><br><span class="line">		x=neg?-x:x;</span><br><span class="line">		<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;is;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ostream</span> &#123;</span></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class">	<span class="title">Ostream</span> &amp;<span class="title">operator</span> &lt;&lt;(T x) &#123;</span></span><br><span class="line"><span class="class">		x&lt;0 &amp;&amp; (putchar('-'),x=-x);</span></span><br><span class="line"><span class="class">		static char stack[233];static int top;</span></span><br><span class="line"><span class="class">		for(top=0;x;stack[++top]=x%10+'0',x/=10);</span></span><br><span class="line"><span class="class">		for(top==0 &amp;&amp; (stack[top=1]='0');top;putchar(stack[top--]));</span></span><br><span class="line"><span class="class">		return *this;</span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">	Ostream &amp;operator &lt;&lt;(char ch) &#123;</span></span><br><span class="line"><span class="class">		putchar(ch);</span></span><br><span class="line"><span class="class">		return *this;</span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">&#125;os;</span></span><br><span class="line"><span class="class">#include &lt;map&gt;</span></span><br><span class="line"><span class="class">#include &lt;cstring&gt;</span></span><br><span class="line"><span class="class">#include &lt;algorithm&gt;</span></span><br><span class="line"><span class="class">#define int64 long long</span></span><br><span class="line"><span class="class">const int MAXN=5000+11,MAXA=2e7+11;</span></span><br><span class="line"><span class="class">int64 C[MAXN][5];</span></span><br><span class="line"><span class="class">struct AtFirst &#123;</span></span><br><span class="line"><span class="class">	AtFirst() &#123;</span></span><br><span class="line"><span class="class">		C[0][0]=1;</span></span><br><span class="line"><span class="class">		for(int i=1;i&lt;MAXN;++i) &#123;</span></span><br><span class="line"><span class="class">			C[i][0]=1;</span></span><br><span class="line"><span class="class">			for(int j=1;j&lt;=std::min(4,i);++j) &#123;</span></span><br><span class="line"><span class="class">				C[i][j]=C[i-1][j-1]+C[i-1][j];</span></span><br><span class="line"><span class="class">			&#125;</span></span><br><span class="line"><span class="class">		&#125;</span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">&#125;autoRun;</span></span><br><span class="line"><span class="class">int main() &#123;</span></span><br><span class="line"><span class="class">	int n;is&gt;&gt;n;</span></span><br><span class="line"><span class="class">	static int a[MAXN];</span></span><br><span class="line"><span class="class">	static int64 single[MAXA],sum2[MAXA];</span></span><br><span class="line"><span class="class">	for(int i=1;i&lt;=n;++i) &#123;</span></span><br><span class="line"><span class="class">		is&gt;&gt;a[i];</span></span><br><span class="line"><span class="class">		single[a[i]]++;</span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">	std::sort(a+1,a+1+n);</span></span><br><span class="line"><span class="class">	n=std::unique(a+1,a+1+n)-a-1;</span></span><br><span class="line"><span class="class">	int64 Ans=0;</span></span><br><span class="line"><span class="class">	//(a+b+c)+d</span></span><br><span class="line"><span class="class">	for(int i=1;i&lt;=n;++i) &#123;</span></span><br><span class="line"><span class="class">		//a&lt;b&lt;c a&lt;b=c a=b&lt;c a=b=c 没法这么分类.</span></span><br><span class="line"><span class="class">		for(int j=i+1;j&lt;=n;++j) &#123;</span></span><br><span class="line"><span class="class">			Ans+=C[single[a[j]]][3]*sum2[a[j]-a[i]]*single[a[i]]//;//C[single[a[j]]][2]..</span></span><br><span class="line"><span class="class">				+C[single[a[j]]][3]*(a[i]*2&lt;a[j] &amp;&amp; a[j]-a[i]*2&lt;a[i]?single[a[j]-a[i]*2]:0)*C[single[a[i]]][2];</span></span><br><span class="line"><span class="class">									//!!!!!!!!!!!!!!</span></span><br><span class="line"><span class="class">		&#125;</span></span><br><span class="line"><span class="class">		if(a[i]%3==0) &#123;</span></span><br><span class="line"><span class="class">			Ans+=C[single[a[i]]][3]*C[single[a[i]/3]][3];</span></span><br><span class="line"><span class="class">		&#125;</span></span><br><span class="line"><span class="class">		for(int j=1;j&lt;=i-1;++j) &#123;</span></span><br><span class="line"><span class="class">			sum2[a[i]+a[j]]+=single[a[i]]*single[a[j]];</span></span><br><span class="line"><span class="class">		&#125;</span></span><br><span class="line"><span class="class">		sum2[a[i]&lt;&lt;1]+=C[single[a[i]]][2];</span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">	memset(sum2,0,sizeof(sum2));</span></span><br><span class="line"><span class="class">	//(a+d)+(b+c)+2e</span></span><br><span class="line"><span class="class">	for(int i=1;i&lt;=n;++i) &#123;</span></span><br><span class="line"><span class="class">		//1 2 2 3 4 4 !!!!!!!</span></span><br><span class="line"><span class="class">		for(int j=i+1;j&lt;=n;++j) if(a[j]-a[i]&lt;a[i]) &#123;//&gt;..</span></span><br><span class="line"><span class="class">			Ans+=C[single[a[j]]][2]*single[a[j]-a[i]]*single[a[i]]*(sum2[a[j]]+((a[j]&amp;1)==0?C[single[a[j]&gt;&gt;1]][2]:0))</span></span><br><span class="line"><span class="class">				+C[single[a[j]]][2]*C[single[a[j]-a[i]]][2]*C[single[a[i]]][2];</span></span><br><span class="line"><span class="class">		&#125;</span></span><br><span class="line"><span class="class">		//a=b&lt;c=d</span></span><br><span class="line"><span class="class">		//sum2全都是instinct的</span></span><br><span class="line"><span class="class">		//a==b==c==d</span></span><br><span class="line"><span class="class">		Ans+=C[single[a[i]]][4]*C[single[a[i]&lt;&lt;1]][2];</span></span><br><span class="line"><span class="class">		for(int j=1;j&lt;=i-1;++j) &#123;</span></span><br><span class="line"><span class="class">			sum2[a[i]+a[j]]+=single[a[i]]*single[a[j]];</span></span><br><span class="line"><span class="class">		&#125;</span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">	os&lt;&lt;Ans&lt;&lt;'\n';</span></span><br><span class="line"><span class="class">	return 0;</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lucida.site/geometry3D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucida">
      <meta itemprop="description" content="It's been a while.">
      <meta itemprop="image" content="/images/luz.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey,Lucida is back.">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/geometry3D/" itemprop="url">
                  3D计算几何的旋转与求交
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-06-08 16:26:08" itemprop="dateCreated datePublished" datetime="2017-06-08T16:26:08+08:00">2017-06-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-06-18 18:23:51" itemprop="dateModified" datetime="2018-06-18T18:23:51+08:00">2018-06-18</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>被faebdc的<code>shadow</code>坑惨了。在考场上才发现自己的3D计算几何知识基本为0。</p>
<h1 id="旋转"><a href="#旋转" class="headerlink" title="旋转"></a>旋转</h1><p>已知点<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo>=</mo><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">P=(x,y,z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mrel">=</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span>，把它沿着<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.012ex" height="3.509ex" style="vertical-align: -0.838ex;" viewbox="0 -1150.1 6894.1 1510.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg">
<defs>
<path stroke-width="1" id="E1-MJMATHI-61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"/>
<path stroke-width="1" id="E1-MJMAIN-20D7" d="M-123 694Q-123 702 -118 708T-103 714Q-93 714 -88 706T-80 687T-67 660T-40 633Q-29 626 -29 615Q-29 606 -36 600T-53 590T-83 571T-121 531Q-135 516 -143 516T-157 522T-163 536T-152 559T-129 584T-116 595H-287L-458 596Q-459 597 -461 599T-466 602T-469 607T-471 615Q-471 622 -458 635H-99Q-123 673 -123 694Z"/>
<path stroke-width="1" id="E1-MJMAIN-2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/>
<path stroke-width="1" id="E1-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/>
<path stroke-width="1" id="E1-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/>
<path stroke-width="1" id="E1-MJMATHI-78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"/>
<path stroke-width="1" id="E1-MJMAIN-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/>
<path stroke-width="1" id="E1-MJMAIN-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"/>
<path stroke-width="1" id="E1-MJMATHI-79" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"/>
<path stroke-width="1" id="E1-MJMATHI-7A" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"/>
<path stroke-width="1" id="E1-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)">
 <use xlink:href="#E1-MJMATHI-61" x="235" y="0"/>
 <use xlink:href="#E1-MJMAIN-2192" x="0" y="561"/>
 <use xlink:href="#E1-MJMAIN-3D" x="1278" y="0"/>
 <use xlink:href="#E1-MJMAIN-28" x="2334" y="0"/>
<g transform="translate(2724,0)">
 <use xlink:href="#E1-MJMATHI-78" x="0" y="0"/>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-30" x="809" y="-213"/>
</g>
 <use xlink:href="#E1-MJMAIN-2C" x="3750" y="0"/>
<g transform="translate(4195,0)">
 <use xlink:href="#E1-MJMATHI-79" x="0" y="0"/>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-30" x="693" y="-213"/>
</g>
 <use xlink:href="#E1-MJMAIN-2C" x="5140" y="0"/>
<g transform="translate(5585,0)">
 <use xlink:href="#E1-MJMATHI-7A" x="0" y="0"/>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-30" x="658" y="-213"/>
</g>
 <use xlink:href="#E1-MJMAIN-29" x="6504" y="0"/>
</g>
</svg>转动<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>θ</mi><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\theta^{\circ}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord">∘</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>（从与向量相对的角度看过去，点是逆时针旋转的）
首先可以给出绕三个轴的旋转矩阵</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>x</mi></msub><mo>(</mo><mi>θ</mi><mo>)</mo><mo>=</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mn>1</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mi>cos</mi><mi>θ</mi></mrow></mtd><mtd><mrow><mo>−</mo><mi>sin</mi><mi>θ</mi></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mi>sin</mi><mi>θ</mi></mrow></mtd><mtd><mrow><mi>cos</mi><mi>θ</mi></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">R_x(\theta)=\begin{bmatrix}
1&amp;0&amp;0\\
0&amp;\cos\theta&amp;-\sin\theta\\
0&amp;\sin\theta&amp;\cos\theta
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.05002em;"></span><span class="strut bottom" style="height:3.60004em;vertical-align:-1.55002em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.00773em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">x</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9049999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-0.89502em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">1</span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop">sin</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord">−</span><span class="mop">sin</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9049999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-0.89502em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></span></span><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>y</mi></msub><mo>(</mo><mi>θ</mi><mo>)</mo><mo>=</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mi>cos</mi><mi>θ</mi></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mi>sin</mi><mi>θ</mi></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>1</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mo>−</mo><mi>sin</mi><mi>θ</mi></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mi>cos</mi><mi>θ</mi></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">R_y(\theta)=\begin{bmatrix}
\cos\theta&amp;0&amp;\sin\theta\\
0&amp;1&amp;0\\
-\sin\theta&amp;0&amp;\cos\theta
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.05002em;"></span><span class="strut bottom" style="height:3.60004em;vertical-align:-1.55002em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.00773em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9049999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-0.89502em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord">−</span><span class="mop">sin</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">1</span></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop">sin</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9049999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-0.89502em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></span></span><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">R_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.00773em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>有些不同，因为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">R_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.00773em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>的变化中<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.04398em;">z</span></span></span></span>等价成了二维的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span></span></span></span>轴，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span></span></span></span>被等价成了<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span>轴</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>z</mi></msub><mo>(</mo><mi>θ</mi><mo>)</mo><mo>=</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mi>cos</mi><mi>θ</mi></mrow></mtd><mtd><mrow><mo>−</mo><mi>sin</mi><mi>θ</mi></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mi>sin</mi><mi>θ</mi></mrow></mtd><mtd><mrow><mi>cos</mi><mi>θ</mi></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>1</mn></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">R_z(\theta)=\begin{bmatrix}
\cos\theta&amp;-\sin\theta&amp;0\\
\sin\theta&amp;\cos\theta&amp;0\\
0&amp;0&amp;1
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.05002em;"></span><span class="strut bottom" style="height:3.60004em;vertical-align:-1.55002em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.00773em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.04398em;">z</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9049999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-0.89502em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop">sin</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord">−</span><span class="mop">sin</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9049999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-0.89502em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></span></span><blockquote>
<p>对于这三个特殊的旋转轴我们已经有了解决方案了，那么对于任意的轴<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.324ex" height="3.009ex" style="vertical-align: -0.338ex;" viewbox="0 -1150.1 1000.5 1295.7" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg">
<defs>
<path stroke-width="1" id="E1-MJMATHI-61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"/>
<path stroke-width="1" id="E1-MJMAIN-20D7" d="M-123 694Q-123 702 -118 708T-103 714Q-93 714 -88 706T-80 687T-67 660T-40 633Q-29 626 -29 615Q-29 606 -36 600T-53 590T-83 571T-121 531Q-135 516 -143 516T-157 522T-163 536T-152 559T-129 584T-116 595H-287L-458 596Q-459 597 -461 599T-466 602T-469 607T-471 615Q-471 622 -458 635H-99Q-123 673 -123 694Z"/>
<path stroke-width="1" id="E1-MJMAIN-2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)">
 <use xlink:href="#E1-MJMATHI-61" x="235" y="0"/>
 <use xlink:href="#E1-MJMAIN-2192" x="0" y="561"/>
</g>
</svg>要怎么办呢？我们可以将这个旋转分解：
将整个坐标轴旋转，使得旋转轴<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.324ex" height="3.009ex" style="vertical-align: -0.338ex;" viewbox="0 -1150.1 1000.5 1295.7" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg">
<defs>
<path stroke-width="1" id="E1-MJMATHI-61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"/>
<path stroke-width="1" id="E1-MJMAIN-20D7" d="M-123 694Q-123 702 -118 708T-103 714Q-93 714 -88 706T-80 687T-67 660T-40 633Q-29 626 -29 615Q-29 606 -36 600T-53 590T-83 571T-121 531Q-135 516 -143 516T-157 522T-163 536T-152 559T-129 584T-116 595H-287L-458 596Q-459 597 -461 599T-466 602T-469 607T-471 615Q-471 622 -458 635H-99Q-123 673 -123 694Z"/>
<path stroke-width="1" id="E1-MJMAIN-2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)">
 <use xlink:href="#E1-MJMATHI-61" x="235" y="0"/>
 <use xlink:href="#E1-MJMAIN-2192" x="0" y="561"/>
</g>
</svg>和<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.04398em;">z</span></span></span></span>轴重合
再将点<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span></span></span></span>绕<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.04398em;">z</span></span></span></span>轴旋转<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span></span>角
再将整个坐标轴旋转回原位</p>
</blockquote>
<p>算了直接上结论。。<a href="http://blog.miskcoo.com/2016/12/rotation-in-3d-space" target="_blank" rel="noopener">Miskcoo</a></p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mi>cos</mi><mi>θ</mi><mo>+</mo><msup><mi>x</mi><mn>2</mn></msup><mo>(</mo><mn>1</mn><mo>−</mo><mi>cos</mi><mi>θ</mi><mo>)</mo></mrow></mtd><mtd><mrow><mi>x</mi><mi>y</mi><mo>(</mo><mn>1</mn><mo>−</mo><mi>cos</mi><mi>θ</mi><mo>)</mo><mo>−</mo><mi>z</mi><mi>sin</mi><mi>θ</mi></mrow></mtd><mtd><mrow><mi>x</mi><mi>z</mi><mo>(</mo><mn>1</mn><mo>−</mo><mi>cos</mi><mi>θ</mi><mo>)</mo><mo>+</mo><mi>y</mi><mi>sin</mi><mi>θ</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>y</mi><mi>x</mi><mo>(</mo><mn>1</mn><mo>−</mo><mi>cos</mi><mi>θ</mi><mo>)</mo><mo>+</mo><mi>z</mi><mi>sin</mi><mi>θ</mi></mrow></mtd><mtd><mrow><mi>cos</mi><mi>θ</mi><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mo>(</mo><mn>1</mn><mo>−</mo><mi>cos</mi><mi>θ</mi><mo>)</mo></mrow></mtd><mtd><mrow><mi>y</mi><mi>z</mi><mo>(</mo><mn>1</mn><mo>−</mo><mi>cos</mi><mi>θ</mi><mo>)</mo><mo>−</mo><mi>x</mi><mi>sin</mi><mi>θ</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>z</mi><mi>x</mi><mo>(</mo><mn>1</mn><mo>−</mo><mi>cos</mi><mi>θ</mi><mo>)</mo><mo>−</mo><mi>y</mi><mi>sin</mi><mi>θ</mi></mrow></mtd><mtd><mrow><mi>z</mi><mi>y</mi><mo>(</mo><mn>1</mn><mo>−</mo><mi>cos</mi><mi>θ</mi><mo>)</mo><mo>+</mo><mi>x</mi><mi>sin</mi><mi>θ</mi></mrow></mtd><mtd><mrow><mi>cos</mi><mi>θ</mi><mo>+</mo><msup><mi>z</mi><mn>2</mn></msup><mo>(</mo><mn>1</mn><mo>−</mo><mi>cos</mi><mi>θ</mi><mo>)</mo></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix}
\cos \theta + x^2(1 - \cos \theta) &amp; xy(1 - \cos \theta) - z\sin \theta &amp; xz(1 - \cos \theta) + y\sin \theta \\
yx(1 - \cos \theta) + z\sin \theta &amp; \cos \theta + y^2(1 - \cos \theta) &amp; yz(1 - \cos \theta) - x\sin \theta \\
zx(1 - \cos \theta) - y\sin \theta &amp; zy(1 - \cos \theta) + x\sin \theta &amp; \cos \theta + z^2(1 - \cos \theta)
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.086162em;"></span><span class="strut bottom" style="height:3.6723239999999997em;vertical-align:-1.586162em;"></span><span class="base displaystyle textstyle uncramped"><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9049999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-0.89502em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-1.222054em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mbin">+</span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span><span style="top:0.0020540000000005em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathit">x</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mop">sin</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span style="top:1.226162em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mord mathit">x</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mop">sin</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-1.222054em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">x</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mop">sin</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span style="top:0.0020540000000005em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span><span style="top:1.226162em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mbin">+</span><span class="mord mathit">x</span><span class="mop">sin</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-1.222054em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">x</span><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mop">sin</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span style="top:0.0020540000000005em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mbin">−</span><span class="mord mathit">x</span><span class="mop">sin</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span style="top:1.226162em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mop">cos</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9049999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-0.89502em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></span></span><p>还是很优美的。</p>
<h1 id="线面相交"><a href="#线面相交" class="headerlink" title="线面相交"></a>线面相交</h1><p>设平面的法向量为<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.324ex" height="3.009ex" style="vertical-align: -0.338ex;" viewbox="0 -1150.1 1000.5 1295.7" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg">
<defs>
<path stroke-width="1" id="E1-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/>
<path stroke-width="1" id="E1-MJMAIN-20D7" d="M-123 694Q-123 702 -118 708T-103 714Q-93 714 -88 706T-80 687T-67 660T-40 633Q-29 626 -29 615Q-29 606 -36 600T-53 590T-83 571T-121 531Q-135 516 -143 516T-157 522T-163 536T-152 559T-129 584T-116 595H-287L-458 596Q-459 597 -461 599T-466 602T-469 607T-471 615Q-471 622 -458 635H-99Q-123 673 -123 694Z"/>
<path stroke-width="1" id="E1-MJMAIN-2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)">
 <use xlink:href="#E1-MJMATHI-6E" x="200" y="0"/>
 <use xlink:href="#E1-MJMAIN-2192" x="0" y="563"/>
</g>
</svg>，平面上有一点<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span></span></span></span>。有直线<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.698ex" height="3.343ex" style="vertical-align: -0.671ex;" viewbox="0 -1150.1 5036.8 1439.2" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg">
<defs>
<path stroke-width="1" id="E1-MJMATHI-6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"/>
<path stroke-width="1" id="E1-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/>
<path stroke-width="1" id="E1-MJMATHI-51" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"/>
<path stroke-width="1" id="E1-MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/>
<path stroke-width="1" id="E1-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/>
<path stroke-width="1" id="E1-MJMATHI-76" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/>
<path stroke-width="1" id="E1-MJMAIN-20D7" d="M-123 694Q-123 702 -118 708T-103 714Q-93 714 -88 706T-80 687T-67 660T-40 633Q-29 626 -29 615Q-29 606 -36 600T-53 590T-83 571T-121 531Q-135 516 -143 516T-157 522T-163 536T-152 559T-129 584T-116 595H-287L-458 596Q-459 597 -461 599T-466 602T-469 607T-471 615Q-471 622 -458 635H-99Q-123 673 -123 694Z"/>
<path stroke-width="1" id="E1-MJMAIN-2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)">
 <use xlink:href="#E1-MJMATHI-6C" x="0" y="0"/>
 <use xlink:href="#E1-MJMAIN-3D" x="576" y="0"/>
 <use xlink:href="#E1-MJMATHI-51" x="1632" y="0"/>
 <use xlink:href="#E1-MJMAIN-2B" x="2646" y="0"/>
 <use xlink:href="#E1-MJMATHI-74" x="3647" y="0"/>
<g transform="translate(4008,0)">
 <use xlink:href="#E1-MJMATHI-76" x="257" y="0"/>
 <use xlink:href="#E1-MJMAIN-2192" x="27" y="563"/>
</g>
</g>
</svg>。</p>
<p>设交点为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.07153em;">C</span></span></span></span>，则</p>
<p style="text-align: center; "><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="19.05ex" height="7.509ex" style="vertical-align: -3.171ex;" viewbox="0 -1867.7 8202 3233.2" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg">
<defs>
<path stroke-width="1" id="E1-MJMAIN-7B" d="M434 -231Q434 -244 428 -250H410Q281 -250 230 -184Q225 -177 222 -172T217 -161T213 -148T211 -133T210 -111T209 -84T209 -47T209 0Q209 21 209 53Q208 142 204 153Q203 154 203 155Q189 191 153 211T82 231Q71 231 68 234T65 250T68 266T82 269Q116 269 152 289T203 345Q208 356 208 377T209 529V579Q209 634 215 656T244 698Q270 724 324 740Q361 748 377 749Q379 749 390 749T408 750H428Q434 744 434 732Q434 719 431 716Q429 713 415 713Q362 710 332 689T296 647Q291 634 291 499V417Q291 370 288 353T271 314Q240 271 184 255L170 250L184 245Q202 239 220 230T262 196T290 137Q291 131 291 1Q291 -134 296 -147Q306 -174 339 -192T415 -213Q429 -213 431 -216Q434 -219 434 -231Z"/>
<path stroke-width="1" id="E1-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/>
<path stroke-width="1" id="E1-MJMATHI-43" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"/>
<path stroke-width="1" id="E1-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/>
<path stroke-width="1" id="E1-MJMATHI-50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/>
<path stroke-width="1" id="E1-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/>
<path stroke-width="1" id="E1-MJMAIN-22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"/>
<path stroke-width="1" id="E1-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/>
<path stroke-width="1" id="E1-MJMAIN-20D7" d="M-123 694Q-123 702 -118 708T-103 714Q-93 714 -88 706T-80 687T-67 660T-40 633Q-29 626 -29 615Q-29 606 -36 600T-53 590T-83 571T-121 531Q-135 516 -143 516T-157 522T-163 536T-152 559T-129 584T-116 595H-287L-458 596Q-459 597 -461 599T-466 602T-469 607T-471 615Q-471 622 -458 635H-99Q-123 673 -123 694Z"/>
<path stroke-width="1" id="E1-MJMAIN-2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/>
<path stroke-width="1" id="E1-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/>
<path stroke-width="1" id="E1-MJMAIN-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/>
<path stroke-width="1" id="E1-MJMATHI-51" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"/>
<path stroke-width="1" id="E1-MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/>
<path stroke-width="1" id="E1-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/>
<path stroke-width="1" id="E1-MJMAIN-2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"/>
<path stroke-width="1" id="E1-MJMATHI-76" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/>
<path stroke-width="1" id="E1-MJSZ4-7B" d="M661 -1243L655 -1249H622L604 -1240Q503 -1190 434 -1107T348 -909Q346 -897 346 -499L345 -98L343 -82Q335 3 287 87T157 223Q146 232 145 236Q144 240 144 250Q144 265 145 268T157 278Q242 333 288 417T343 583L345 600L346 1001Q346 1398 348 1410Q379 1622 600 1739L622 1750H655L661 1744V1727V1721Q661 1712 661 1710T657 1705T648 1700T630 1690T602 1668Q589 1659 574 1643T531 1593T484 1508T459 1398Q458 1389 458 1001Q458 614 457 605Q441 435 301 316Q254 277 202 251L250 222Q260 216 301 185Q443 66 457 -104Q458 -113 458 -501Q458 -888 459 -897Q463 -944 478 -988T509 -1060T548 -1114T580 -1149T602 -1167Q620 -1183 634 -1192T653 -1202T659 -1207T661 -1220V-1226V-1243Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)">
 <use xlink:href="#E1-MJSZ4-7B"/>
<g transform="translate(973,0)">
<g transform="translate(-11,0)">
<g transform="translate(0,625)">
 <use xlink:href="#E1-MJMAIN-28" x="0" y="0"/>
 <use xlink:href="#E1-MJMATHI-43" x="389" y="0"/>
 <use xlink:href="#E1-MJMAIN-2212" x="1372" y="0"/>
 <use xlink:href="#E1-MJMATHI-50" x="2372" y="0"/>
 <use xlink:href="#E1-MJMAIN-29" x="3124" y="0"/>
 <use xlink:href="#E1-MJMAIN-22C5" x="3736" y="0"/>
<g transform="translate(4236,0)">
 <use xlink:href="#E1-MJMATHI-6E" x="200" y="0"/>
 <use xlink:href="#E1-MJMAIN-2192" x="0" y="563"/>
</g>
 <use xlink:href="#E1-MJMAIN-3D" x="5515" y="0"/>
 <use xlink:href="#E1-MJMAIN-30" x="6571" y="0"/>
</g>
<g transform="translate(0,-1002)">
 <use xlink:href="#E1-MJMATHI-43" x="0" y="0"/>
 <use xlink:href="#E1-MJMAIN-3D" x="1038" y="0"/>
 <use xlink:href="#E1-MJMATHI-51" x="2094" y="0"/>
 <use xlink:href="#E1-MJMAIN-2B" x="3108" y="0"/>
<g transform="translate(4109,0)">
 <use xlink:href="#E1-MJMATHI-74" x="0" y="0"/>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-2032" x="511" y="583"/>
</g>
<g transform="translate(4765,0)">
 <use xlink:href="#E1-MJMATHI-76" x="257" y="0"/>
 <use xlink:href="#E1-MJMAIN-2192" x="27" y="563"/>
</g>
</g>
</g>
</g>
</g>
</svg></p><p>解得<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.695ex" height="7.343ex" style="vertical-align: -2.838ex;" viewbox="0 -1939.5 7618.8 3161.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg">
<defs>
<path stroke-width="1" id="E1-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/>
<path stroke-width="1" id="E1-MJMAIN-2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"/>
<path stroke-width="1" id="E1-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/>
<path stroke-width="1" id="E1-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"/>
<path stroke-width="1" id="E1-MJMATHI-50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"/>
<path stroke-width="1" id="E1-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/>
<path stroke-width="1" id="E1-MJMATHI-51" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"/>
<path stroke-width="1" id="E1-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"/>
<path stroke-width="1" id="E1-MJMAIN-22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"/>
<path stroke-width="1" id="E1-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/>
<path stroke-width="1" id="E1-MJMAIN-20D7" d="M-123 694Q-123 702 -118 708T-103 714Q-93 714 -88 706T-80 687T-67 660T-40 633Q-29 626 -29 615Q-29 606 -36 600T-53 590T-83 571T-121 531Q-135 516 -143 516T-157 522T-163 536T-152 559T-129 584T-116 595H-287L-458 596Q-459 597 -461 599T-466 602T-469 607T-471 615Q-471 622 -458 635H-99Q-123 673 -123 694Z"/>
<path stroke-width="1" id="E1-MJMAIN-2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/>
<path stroke-width="1" id="E1-MJMATHI-76" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)">
 <use xlink:href="#E1-MJMATHI-74" x="0" y="0"/>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-2032" x="511" y="513"/>
 <use xlink:href="#E1-MJMAIN-3D" x="934" y="0"/>
<g transform="translate(1990,0)">
<g transform="translate(120,0)">
<rect stroke="none" width="5388" height="60" x="0" y="220"/>
<g transform="translate(60,770)">
 <use xlink:href="#E1-MJMAIN-28" x="0" y="0"/>
 <use xlink:href="#E1-MJMATHI-50" x="389" y="0"/>
 <use xlink:href="#E1-MJMAIN-2212" x="1363" y="0"/>
 <use xlink:href="#E1-MJMATHI-51" x="2363" y="0"/>
 <use xlink:href="#E1-MJMAIN-29" x="3155" y="0"/>
 <use xlink:href="#E1-MJMAIN-22C5" x="3767" y="0"/>
<g transform="translate(4267,0)">
 <use xlink:href="#E1-MJMATHI-6E" x="200" y="0"/>
 <use xlink:href="#E1-MJMAIN-2192" x="0" y="563"/>
</g>
</g>
<g transform="translate(1318,-1096)">
 <use xlink:href="#E1-MJMATHI-76" x="257" y="0"/>
 <use xlink:href="#E1-MJMAIN-2192" x="27" y="563"/>
 <use xlink:href="#E1-MJMAIN-22C5" x="1250" y="0"/>
<g transform="translate(1751,0)">
 <use xlink:href="#E1-MJMATHI-6E" x="200" y="0"/>
 <use xlink:href="#E1-MJMAIN-2192" x="0" y="563"/>
</g>
</g>
</g>
</g>
</g>
</svg></p>
<p>当<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.391ex" height="3.009ex" style="vertical-align: -0.338ex;" viewbox="0 -1150.1 2751.7 1295.7" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg">
<defs>
<path stroke-width="1" id="E1-MJMATHI-76" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"/>
<path stroke-width="1" id="E1-MJMAIN-20D7" d="M-123 694Q-123 702 -118 708T-103 714Q-93 714 -88 706T-80 687T-67 660T-40 633Q-29 626 -29 615Q-29 606 -36 600T-53 590T-83 571T-121 531Q-135 516 -143 516T-157 522T-163 536T-152 559T-129 584T-116 595H-287L-458 596Q-459 597 -461 599T-466 602T-469 607T-471 615Q-471 622 -458 635H-99Q-123 673 -123 694Z"/>
<path stroke-width="1" id="E1-MJMAIN-2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"/>
<path stroke-width="1" id="E1-MJMAIN-22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"/>
<path stroke-width="1" id="E1-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)">
 <use xlink:href="#E1-MJMATHI-76" x="257" y="0"/>
 <use xlink:href="#E1-MJMAIN-2192" x="27" y="563"/>
 <use xlink:href="#E1-MJMAIN-22C5" x="1250" y="0"/>
<g transform="translate(1751,0)">
 <use xlink:href="#E1-MJMATHI-6E" x="200" y="0"/>
 <use xlink:href="#E1-MJMAIN-2192" x="0" y="563"/>
</g>
</g>
</svg>的时候，显然交点不存在。</p>
<p>这种法线的操作对于二维的线线相交依然适用，比面积法或者体积法显然得多，好记得多，而且数值稳定性并没有损失。</p>
<h1 id="一道题"><a href="#一道题" class="headerlink" title="一道题"></a>一道题</h1><p>附上一道练手题目：<a href="https://ly.men.ci/problem/307" target="_blank" rel="noopener">Shadow</a></p>
<p>这道题目存在更简洁的做法，但是为了强行套模板，我选择了一种非常难受的转化：把坐标系强行转化成地面是坐标平面，转化成把<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo>)</mo><mo separator="true">,</mo><mi>B</mi><mo separator="true">,</mo><mi>C</mi></mrow><annotation encoding="application/x-tex">(0,0,0),B,C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.07153em;">C</span></span></span></span>构成的三角形转到<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mi>O</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">xOy</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span>面上。详见代码，实在是恶心得不想多说。</p>
<p>写完1A好评。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Istream</span> &#123;</span></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; </span></span><br><span class="line"><span class="class">	<span class="title">Istream</span> &amp;<span class="title">operator</span> &gt;&gt;(<span class="title">T</span> &amp;<span class="title">x</span>) &#123;</span></span><br><span class="line">		<span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">static</span> <span class="keyword">bool</span> neg;</span><br><span class="line">		<span class="keyword">for</span>(ch=neg=<span class="number">0</span>;ch&lt;<span class="string">'0'</span> || <span class="string">'9'</span>&lt;ch;neg|=ch==<span class="string">'-'</span>,ch=getchar());</span><br><span class="line">		<span class="keyword">for</span>(x=<span class="number">0</span>;<span class="string">'0'</span>&lt;=ch &amp;&amp; ch&lt;=<span class="string">'9'</span>;(x*=<span class="number">10</span>)+=ch-<span class="string">'0'</span>,ch=getchar());</span><br><span class="line">		x=neg?-x:x;</span><br><span class="line">		<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Istream &amp;<span class="keyword">operator</span> &gt;&gt;(<span class="keyword">double</span> &amp;x) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%lf"</span>,&amp;x);</span><br><span class="line">		<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;is;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ostream</span> &#123;</span></span><br><span class="line">	<span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class">	<span class="title">Ostream</span> &amp;<span class="title">operator</span> &lt;&lt;(T x) &#123;</span></span><br><span class="line"><span class="class">		x&lt;0 &amp;&amp; (putchar('-'),x=-x);</span></span><br><span class="line"><span class="class">		static char stack[233];static int top;</span></span><br><span class="line"><span class="class">		for(top=0;x;stack[++top]=x%10+'0',x/=10);</span></span><br><span class="line"><span class="class">		for(top==0 &amp;&amp; (stack[top=1]='0');top;putchar(stack[top--]));</span></span><br><span class="line"><span class="class">		return *this;</span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">	Ostream &amp;operator &lt;&lt;(double const &amp;x) &#123;</span></span><br><span class="line"><span class="class">		printf("%.2lf",x);</span></span><br><span class="line"><span class="class">		return *this;</span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">	Ostream &amp;operator &lt;&lt;(char ch) &#123;</span></span><br><span class="line"><span class="class">		putchar(ch);</span></span><br><span class="line"><span class="class">		return *this;</span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">&#125;os;</span></span><br><span class="line"><span class="class">#include &lt;cmath&gt;</span></span><br><span class="line"><span class="class">#include &lt;cassert&gt;</span></span><br><span class="line"><span class="class">#include &lt;algorithm&gt;</span></span><br><span class="line"><span class="class">const int MAXN=100+11;</span></span><br><span class="line"><span class="class">const double eps=1e-7,pi=acos(-1);</span></span><br><span class="line"><span class="class">inline int sgn(double const &amp;x) &#123; return (x&gt;eps)-(x&lt;-eps); &#125;</span></span><br><span class="line"><span class="class">#define SELF_OPER(Type,op) template &lt;class T&gt; Type &amp;operator op##=(T const &amp;x) &#123; return *this=*this op x; &#125; </span></span><br><span class="line"><span class="class">namespace _3D &#123;</span></span><br><span class="line"><span class="class">typedef struct Point Vector;</span></span><br><span class="line"><span class="class">struct Point &#123;</span></span><br><span class="line"><span class="class">	double x,y,z;</span></span><br><span class="line"><span class="class">	Point() &#123;&#125;</span></span><br><span class="line"><span class="class">	Point(double const &amp;x,double const &amp;y,double const &amp;z):x(x),y(y),z(z) &#123;&#125;</span></span><br><span class="line"><span class="class">	double Length() const &#123; return sqrt(x*x+y*y+z*z); &#125;</span></span><br><span class="line"><span class="class">	friend double Inner(Vector const &amp;a,Vector const &amp;b) &#123; return a.x*b.x+a.y*b.y+a.z*b.z; &#125;</span></span><br><span class="line"><span class="class">	friend Vector Outer(Vector const &amp;a,Vector const &amp;b) &#123; return Vector(a.y*b.z-a.z*b.y,a.z*b.x-a.x*b.z,a.x*b.y-a.y*b.x); &#125;</span></span><br><span class="line"><span class="class">	friend Point operator +(Point const &amp;lhs,Vector const &amp;rhs) &#123; return Point(lhs.x+rhs.x,lhs.y+rhs.y,lhs.z+rhs.z); &#125;</span></span><br><span class="line"><span class="class">	friend Vector operator -(Point const &amp;lhs,Point const &amp;rhs) &#123; return Vector(lhs.x-rhs.x,lhs.y-rhs.y,lhs.z-rhs.z); &#125;</span></span><br><span class="line"><span class="class">	friend Vector operator *(Vector const &amp;lhs,double const &amp;rhs) &#123;	return Vector(lhs.x*rhs,lhs.y*rhs,lhs.z*rhs); &#125;</span></span><br><span class="line"><span class="class">	friend Vector operator /(Vector const &amp;lhs,double const &amp;rhs) &#123;	return Vector(lhs.x/rhs,lhs.y/rhs,lhs.z/rhs); &#125;</span></span><br><span class="line"><span class="class">	SELF_OPER(Point,+)</span></span><br><span class="line"><span class="class">	SELF_OPER(Point,-)</span></span><br><span class="line"><span class="class">	SELF_OPER(Point,*)</span></span><br><span class="line"><span class="class">	SELF_OPER(Point,/)</span></span><br><span class="line"><span class="class">	friend double Angle(Vector const &amp;v1,Vector const &amp;v2) &#123; return asin(Outer(v1,v2).Length()/(v1.Length()*v2.Length())); &#125;</span></span><br><span class="line"><span class="class">	friend Istream &amp;operator &gt;&gt;(Istream &amp;is,Point &amp;p) &#123;</span></span><br><span class="line"><span class="class">		is&gt;&gt;p.x&gt;&gt;p.y&gt;&gt;<span class="title">p</span>.<span class="title">z</span>;</span></span><br><span class="line">		<span class="keyword">return</span> is;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">friend</span> Ostream &amp;<span class="keyword">operator</span> &lt;&lt;(Ostream &amp;os,Point <span class="keyword">const</span> &amp;p) &#123;</span><br><span class="line">		os&lt;&lt;<span class="string">'('</span>&lt;&lt;p.x&lt;&lt;<span class="string">','</span>&lt;&lt;p.y&lt;&lt;<span class="string">','</span>&lt;&lt;p.z&lt;&lt;<span class="string">')'</span>;</span><br><span class="line">		<span class="keyword">return</span> os;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;p[MAXN];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Line</span> &#123;</span></span><br><span class="line">	Point p;</span><br><span class="line">	Vector v;</span><br><span class="line">	Line() &#123;&#125;</span><br><span class="line">	Line(Point <span class="keyword">const</span> &amp;p,Vector <span class="keyword">const</span> &amp;v):p(p),v(v) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function">Point <span class="title">Rotate</span><span class="params">(Line <span class="keyword">const</span> &amp;ln,Point p,<span class="keyword">double</span> <span class="keyword">const</span> &amp;rad)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">double</span> co,si;</span><br><span class="line">	<span class="keyword">static</span> Vector a;</span><br><span class="line">	si=<span class="built_in">sin</span>(rad),co=<span class="built_in">cos</span>(rad);</span><br><span class="line">	a=ln.v/ln.v.Length();</span><br><span class="line">	<span class="keyword">double</span> T[][<span class="number">3</span>]=&#123;&#123;co+a.x*a.x*(<span class="number">1</span>-co),a.x*a.y*(<span class="number">1</span>-co)-a.z*si,a.x*a.z*(<span class="number">1</span>-co)+a.y*si&#125;,</span><br><span class="line">				  &#123;a.y*a.x*(<span class="number">1</span>-co)+a.z*si,co+a.y*a.y*(<span class="number">1</span>-co),a.y*a.z*(<span class="number">1</span>-co)-a.x*si&#125;,</span><br><span class="line">				  &#123;a.z*a.x*(<span class="number">1</span>-co)-a.y*si,a.z*a.y*(<span class="number">1</span>-co)+a.x*si,co+a.z*a.z*(<span class="number">1</span>-co)&#125;&#125;;</span><br><span class="line">	p-=ln.p;</span><br><span class="line">	p=Point(p.x*T[<span class="number">0</span>][<span class="number">0</span>]+p.y*T[<span class="number">1</span>][<span class="number">0</span>]+p.z*T[<span class="number">2</span>][<span class="number">0</span>],</span><br><span class="line">			p.x*T[<span class="number">0</span>][<span class="number">1</span>]+p.y*T[<span class="number">1</span>][<span class="number">1</span>]+p.z*T[<span class="number">2</span>][<span class="number">1</span>],</span><br><span class="line">			p.x*T[<span class="number">0</span>][<span class="number">2</span>]+p.y*T[<span class="number">1</span>][<span class="number">2</span>]+p.z*T[<span class="number">2</span>][<span class="number">2</span>]);</span><br><span class="line">	<span class="keyword">return</span> p+=ln.p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Plane</span> &#123;</span></span><br><span class="line">	Point p;Vector nv;</span><br><span class="line">	Plane(Point <span class="keyword">const</span> &amp;p1,Point <span class="keyword">const</span> &amp;p2,Point <span class="keyword">const</span> &amp;p3):p(p1),nv(Outer(p2-p1,p3-p1)) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">const Plane GROUND(Point(0,0,0),Point(1,0,0),Point(0,1,0));</span><br><span class="line"><span class="function">Point <span class="title">Cross</span><span class="params">(Line ln,Plane pln)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">double</span> d1=-Inner(pln.nv,ln.p-pln.p),d2=Inner(pln.nv,ln.v);<span class="comment">//d1/d2</span></span><br><span class="line">	<span class="keyword">if</span>(d2==<span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">throw</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> ln.p+ln.v*(d1/d2);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> _2D &#123;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Point</span> <span class="title">Vector</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> &#123;</span></span><br><span class="line">	<span class="keyword">double</span> x,y;</span><br><span class="line">	Point() &#123;&#125;</span><br><span class="line">	Point(<span class="keyword">double</span> <span class="keyword">const</span> &amp;x,<span class="keyword">double</span> <span class="keyword">const</span> &amp;y):x(x),y(y) &#123;&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(Point <span class="keyword">const</span> &amp;lhs,Point <span class="keyword">const</span> &amp;rhs) &#123;	<span class="keyword">return</span> lhs.x==rhs.x?lhs.y&lt;rhs.y:lhs.x&lt;rhs.x; &#125;</span><br><span class="line">	<span class="keyword">friend</span> Vector <span class="keyword">operator</span> +(Point <span class="keyword">const</span> &amp;lhs,Vector <span class="keyword">const</span> &amp;rhs) &#123; <span class="keyword">return</span> Vector(lhs.x+rhs.x,lhs.y+rhs.y); &#125;</span><br><span class="line">	<span class="keyword">friend</span> Vector <span class="keyword">operator</span> -(Point <span class="keyword">const</span> &amp;lhs,Point <span class="keyword">const</span> &amp;rhs) &#123; <span class="keyword">return</span> Vector(lhs.x-rhs.x,lhs.y-rhs.y); &#125;</span><br><span class="line">	<span class="keyword">friend</span> Vector <span class="keyword">operator</span> *(Vector <span class="keyword">const</span> &amp;lhs,<span class="keyword">double</span> <span class="keyword">const</span> &amp;rhs) &#123; <span class="keyword">return</span> Vector(lhs.x*rhs,lhs.y*rhs); &#125;</span><br><span class="line">	<span class="keyword">friend</span> Vector <span class="keyword">operator</span> /(Vector <span class="keyword">const</span> &amp;lhs,<span class="keyword">double</span> <span class="keyword">const</span> &amp;rhs) &#123;	<span class="keyword">return</span> Vector(lhs.x/rhs,lhs.y/rhs); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">friend</span> <span class="keyword">double</span> <span class="title">Inner</span><span class="params">(Vector <span class="keyword">const</span> &amp;a,Vector <span class="keyword">const</span> &amp;b)</span> </span>&#123; <span class="keyword">return</span> a.x*b.x+a.y*b.y; &#125;</span><br><span class="line">	<span class="function"><span class="keyword">friend</span> <span class="keyword">double</span> <span class="title">Outer</span><span class="params">(Vector <span class="keyword">const</span> &amp;a,Vector <span class="keyword">const</span> &amp;b)</span> </span>&#123; <span class="keyword">return</span> a.x*b.y-a.y*b.x; &#125;</span><br><span class="line">&#125;p[MAXN];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Line</span> &#123;</span></span><br><span class="line">	Point p;Vector v;</span><br><span class="line">	Line() &#123;&#125;</span><br><span class="line">	Line(Point <span class="keyword">const</span> &amp;p,Vector <span class="keyword">const</span> &amp;v):p(p),v(v) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function">Point <span class="title">Cross</span><span class="params">(Line <span class="keyword">const</span> &amp;ln1,Line <span class="keyword">const</span> &amp;ln2)</span> </span>&#123;</span><br><span class="line">	<span class="function">Vector <span class="title">norm</span><span class="params">(-ln2.v.y,ln2.v.x)</span></span>;</span><br><span class="line">	<span class="keyword">double</span> d1=-Inner(norm,ln1.p-ln2.p),d2=Inner(ln1.v,norm);</span><br><span class="line">	<span class="keyword">return</span> ln1.p+ln1.v*(d1/d2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">HullSize</span><span class="params">(Point p[],<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::sort(p+<span class="number">1</span>,p+<span class="number">1</span>+n);</span><br><span class="line">	<span class="keyword">static</span> Point <span class="built_in">stack</span>[MAXN];</span><br><span class="line">	<span class="keyword">int</span> top=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		<span class="keyword">while</span>(top&gt;=<span class="number">2</span> &amp;&amp; Outer(<span class="built_in">stack</span>[top]-<span class="built_in">stack</span>[top<span class="number">-1</span>],p[i]-<span class="built_in">stack</span>[top])&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">			top--;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">stack</span>[++top]=p[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> mid=top;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=n;i&gt;=<span class="number">1</span>;--i) &#123;</span><br><span class="line">		<span class="keyword">while</span>(top&gt;=mid+<span class="number">1</span> &amp;&amp; Outer(<span class="built_in">stack</span>[top]-<span class="built_in">stack</span>[top<span class="number">-1</span>],p[i]-<span class="built_in">stack</span>[top])&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">			top--;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">stack</span>[++top]=p[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(top) &#123;</span><br><span class="line">		top--;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">double</span> res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=top;++i) &#123;</span><br><span class="line">		res+=Outer(<span class="built_in">stack</span>[i],<span class="built_in">stack</span>[i==top?<span class="number">1</span>:i+<span class="number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res/<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> _3D;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Transform</span><span class="params">(Point g[],Point &amp;light,Point p[],<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">	Point &amp;o=g[<span class="number">0</span>];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		p[i]-=o;</span><br><span class="line">	&#125;</span><br><span class="line">	light-=o;</span><br><span class="line">	g[<span class="number">2</span>]-=o;</span><br><span class="line">	g[<span class="number">1</span>]-=o;</span><br><span class="line">	g[<span class="number">0</span>]-=o;</span><br><span class="line">	Line axis;<span class="keyword">double</span> angle;</span><br><span class="line">	axis=Line(o,Vector(-g[<span class="number">1</span>].y,g[<span class="number">1</span>].x,<span class="number">0</span>));</span><br><span class="line">	angle=sgn(g[<span class="number">1</span>].x)==<span class="number">0</span> &amp;&amp; sgn(g[<span class="number">1</span>].y)==<span class="number">0</span>?pi/<span class="number">2</span>:Angle(g[<span class="number">1</span>],Vector(g[<span class="number">1</span>].x,g[<span class="number">1</span>].y,<span class="number">0</span>));</span><br><span class="line">	<span class="keyword">if</span>(sgn(Rotate(axis,g[<span class="number">1</span>],angle).z)!=<span class="number">0</span>) &#123;</span><br><span class="line">		angle*=<span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		p[i]=Rotate(axis,p[i],angle);</span><br><span class="line">	&#125;</span><br><span class="line">	light=Rotate(axis,light,angle);</span><br><span class="line">	g[<span class="number">1</span>]=Rotate(axis,g[<span class="number">1</span>],angle);</span><br><span class="line">	g[<span class="number">2</span>]=Rotate(axis,g[<span class="number">2</span>],angle);</span><br><span class="line">	assert(sgn(g[<span class="number">1</span>].z)==<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	_2D::Point _crs=_2D::Cross(_2D::Line(_2D::Point(g[<span class="number">2</span>].x,g[<span class="number">2</span>].y),_2D::Vector(-g[<span class="number">1</span>].y,g[<span class="number">1</span>].x)),_2D::Line(_2D::Point(<span class="number">0</span>,<span class="number">0</span>),_2D::Point(g[<span class="number">1</span>].x,g[<span class="number">1</span>].y)));</span><br><span class="line">	Point crs=Point(_crs.x,_crs.y,<span class="number">0</span>);</span><br><span class="line">	axis=Line(o,g[<span class="number">1</span>]);</span><br><span class="line">	angle=sgn(g[<span class="number">2</span>].x-crs.x)==<span class="number">0</span> &amp;&amp; sgn(g[<span class="number">2</span>].y-crs.y)==<span class="number">0</span>?pi/<span class="number">2</span>:Angle(g[<span class="number">2</span>]-crs,Point(g[<span class="number">2</span>].x,g[<span class="number">2</span>].y,<span class="number">0</span>)-crs);</span><br><span class="line">	<span class="keyword">if</span>(sgn(Rotate(axis,g[<span class="number">2</span>],angle).z)!=<span class="number">0</span>) &#123;</span><br><span class="line">		angle*=<span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		p[i]=Rotate(axis,p[i],angle);</span><br><span class="line">	&#125;</span><br><span class="line">	light=Rotate(axis,light,angle);</span><br><span class="line">	g[<span class="number">2</span>]=Rotate(axis,g[<span class="number">2</span>],angle);</span><br><span class="line">	assert(sgn(g[<span class="number">2</span>].z)==<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></span><br><span class="line">	freopen(<span class="string">"input"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">	freopen(<span class="string">"shadow.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">	freopen(<span class="string">"shadow.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	Point g[<span class="number">3</span>];is&gt;&gt;g[<span class="number">0</span>]&gt;&gt;g[<span class="number">1</span>]&gt;&gt;g[<span class="number">2</span>];</span><br><span class="line">	Point light;is&gt;&gt;light;</span><br><span class="line">	<span class="keyword">int</span> n;is&gt;&gt;n;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		is&gt;&gt;p[i];</span><br><span class="line">	&#125;</span><br><span class="line">	Transform(g,light,p,n);</span><br><span class="line">	<span class="function">Plane <span class="title">pln</span><span class="params">(g[<span class="number">0</span>],g[<span class="number">1</span>],g[<span class="number">2</span>])</span></span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		Point crs=Cross(Line(light,p[i]-light),pln);</span><br><span class="line">		_2D::p[i]=_2D::Point(crs.x,crs.y);</span><br><span class="line">	&#125;</span><br><span class="line">	os&lt;&lt;_2D::HullSize(_2D::p,n)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lucida.site/BZOJ4012/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucida">
      <meta itemprop="description" content="It's been a while.">
      <meta itemprop="image" content="/images/luz.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey,Lucida is back.">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/BZOJ4012/" itemprop="url">
                  BZOJ 4012 开店
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-04-04 00:00:00" itemprop="dateCreated datePublished" datetime="2017-04-04T00:00:00+08:00">2017-04-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-06-18 18:23:51" itemprop="dateModified" datetime="2018-06-18T18:23:51+08:00">2018-06-18</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Link"><a href="#Link" class="headerlink" title="Link"></a><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=4012" target="_blank" rel="noopener">Link</a></h1><h1 id="Solution-树链剖分套主席树"><a href="#Solution-树链剖分套主席树" class="headerlink" title="Solution 树链剖分套主席树"></a>Solution 树链剖分套主席树</h1><p>先不管颜色的限制
形式化条件：(<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>e</mi><mi>n</mi><mo>[</mo><mi>x</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">len[x]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mopen">[</span><span class="mord mathit">x</span><span class="mclose">]</span></span></span></span>为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span></span></span></span>到根节点的距离)
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mi>n</mi><mi>s</mi><mo>=</mo><msub><mo>∑</mo><mrow><mi>p</mi><mi>o</mi><mi>s</mi></mrow></msub><mi>l</mi><mi>e</mi><mi>n</mi><mo>[</mo><mi>u</mi><mo>]</mo><mo>+</mo><mi>l</mi><mi>e</mi><mi>n</mi><mo>[</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo>]</mo><mo>−</mo><mi>l</mi><mi>e</mi><mi>n</mi><mo>[</mo><mi>l</mi><mi>c</mi><mi>a</mi><mo>(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo separator="true">,</mo><mi>u</mi><mo>)</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">Ans=\sum\limits_{pos} len[u]+len[pos]-len[lca(pos,u)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.7500049999999999em;"></span><span class="strut bottom" style="height:1.836118em;vertical-align:-1.086113em;"></span><span class="base textstyle uncramped"><span class="mord mathit">A</span><span class="mord mathit">n</span><span class="mord mathit">s</span><span class="mrel">=</span><span class="mop op-limits"><span class="vlist"><span style="top:0.8500050000000001em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span></span></span></span><span style="top:-0.0000049999999998662226em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol small-op mop">∑</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mopen">[</span><span class="mord mathit">u</span><span class="mclose">]</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mopen">[</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mclose">]</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">c</span><span class="mord mathit">a</span><span class="mopen">(</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit">u</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span>
可以把<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>e</mi><mi>n</mi><mo>[</mo><mi>u</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">len[u]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mopen">[</span><span class="mord mathit">u</span><span class="mclose">]</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>e</mi><mi>n</mi><mo>[</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">len[pos]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mopen">[</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mclose">]</span></span></span></span>都提出来，答案就变成了计算<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mo>∑</mo><mrow><mi>p</mi><mi>o</mi><mi>s</mi></mrow></msub><mi>l</mi><mi>e</mi><mi>n</mi><mo>[</mo><mi>l</mi><mi>c</mi><mi>a</mi><mo>(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo separator="true">,</mo><mi>u</mi><mo>)</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">\sum\limits_{pos}len[lca(pos,u)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.7500049999999999em;"></span><span class="strut bottom" style="height:1.836118em;vertical-align:-1.086113em;"></span><span class="base textstyle uncramped"><span class="mop op-limits"><span class="vlist"><span style="top:0.8500050000000001em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span></span></span></span><span style="top:-0.0000049999999998662226em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span><span class="op-symbol small-op mop">∑</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">c</span><span class="mord mathit">a</span><span class="mopen">(</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit">u</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span>
也就是<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi><mo separator="true">,</mo><mi>p</mi><mi>o</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">u,pos</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">u</span><span class="mpunct">,</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mord mathit">s</span></span></span></span>到根节点路径的交集。这个可以通过先把每个点到根节点的路径都覆盖一遍，查询时候只需要统计出<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∑</mo><mi>v</mi><mo>[</mo><mi>e</mi><mo>]</mo><mi>c</mi><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>C</mi><mi>n</mi><mi>t</mi><mo>[</mo><mi>e</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">\sum v[e]coverCnt[e]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="base textstyle uncramped"><span class="op-symbol small-op mop" style="top:-0.0000050000000000050004em;">∑</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mopen">[</span><span class="mord mathit">e</span><span class="mclose">]</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mopen">[</span><span class="mord mathit">e</span><span class="mclose">]</span></span></span></span>即可。可以通过线段树实现。其中标记永久化的处理非常有意思。
套上了颜色的限制，就仿照序列主席树的做法，把点按照颜色排序，顺序依次覆盖。
空间上界是<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><msup><mi>log</mi><mn>2</mn></msup><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n\log^2 n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>的，但是似乎跑不满。
时间是<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><msup><mi>log</mi><mn>2</mn></msup><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n\log^2 n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>，常数小，跑得非常快。</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"lucida"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::min;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::max;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::fill;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::sort;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::unique;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::lower_bound;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::upper_bound;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::partial_sum;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN=<span class="number">150000</span>+<span class="number">11</span>,MAXLOGN=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">int</span> nums[MAXN],nc,a[MAXN],order[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">CompareValue</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp;i,<span class="keyword">const</span> <span class="keyword">int</span> &amp;j)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a[i]&lt;a[j];</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to,v;Edge *pre;</span><br><span class="line">	Edge(<span class="keyword">int</span> to,<span class="keyword">int</span> v,Edge *pre):to(to),v(v),pre(pre) &#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="keyword">size_t</span>)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">static</span> Edge *Me=alloc(Edge,MAXN&lt;&lt;<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> Me++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;*G[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Adde</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">	G[f]=<span class="keyword">new</span> Edge(t,v,G[f]);</span><br><span class="line">	G[t]=<span class="keyword">new</span> Edge(f,v,G[t]);</span><br><span class="line">&#125;</span><br><span class="line">int64 pref[MAXN];</span><br><span class="line"><span class="keyword">namespace</span> segtree &#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">int</span> SIZE=MAXN*MAXLOGN*<span class="number">7</span>;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">null</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">		Node *son[<span class="number">2</span>];</span><br><span class="line">		int64 sumv;<span class="keyword">int</span> covc;</span><br><span class="line">		Node():sumv(<span class="number">0</span>) &#123;</span><br><span class="line">			son[<span class="number">0</span>]=son[<span class="number">1</span>]=null;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="keyword">size_t</span>)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">static</span> Node *Me=alloc(Node,SIZE),*Pool=Me;</span><br><span class="line">			assert(Me-Pool&lt;SIZE);</span><br><span class="line">			<span class="keyword">return</span> Me++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;*_null=null=<span class="keyword">new</span> Node,*_null_son=null-&gt;son[<span class="number">0</span>]=null-&gt;son[<span class="number">1</span>]=null;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">SegTree</span> &#123;</span></span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		SegTree() &#123;&#125;</span><br><span class="line">		SegTree(<span class="keyword">int</span> n,<span class="keyword">int</span> L,<span class="keyword">int</span> R):root(alloc(Node*,n+<span class="number">1</span>)),L(L),R(R) &#123;</span><br><span class="line">			fill(root,root+<span class="number">1</span>+n,null);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> rc,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">			Edit(root[rc]=root[rc]==null?root[rc<span class="number">-1</span>]:root[rc],L,R,l,r);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function">int64 <span class="title">Sum</span><span class="params">(<span class="keyword">int</span> cl,<span class="keyword">int</span> cr,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> Access(root[cl<span class="number">-1</span>],root[cr],L,R,l,r);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">		Node **root;<span class="keyword">int</span> L,R;</span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">Edit</span><span class="params">(Node *&amp;pos,<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">			pos=<span class="keyword">new</span> Node(*pos);</span><br><span class="line">			<span class="keyword">if</span>(L==l &amp;&amp; R==r) &#123;</span><br><span class="line">				pos-&gt;covc++;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				pos-&gt;sumv+=pref[r]-pref[l<span class="number">-1</span>];</span><br><span class="line">				<span class="keyword">int</span> Mid=(L+R)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">				<span class="keyword">if</span>(r&lt;=Mid) &#123;</span><br><span class="line">					Edit(pos-&gt;son[<span class="number">0</span>],L,Mid,l,r);</span><br><span class="line">				&#125; <span class="keyword">else</span> <span class="keyword">if</span>(Mid+<span class="number">1</span>&lt;=l) &#123;</span><br><span class="line">					Edit(pos-&gt;son[<span class="number">1</span>],Mid+<span class="number">1</span>,R,l,r);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					Edit(pos-&gt;son[<span class="number">0</span>],L,Mid,l,Mid);</span><br><span class="line">					Edit(pos-&gt;son[<span class="number">1</span>],Mid+<span class="number">1</span>,R,Mid+<span class="number">1</span>,r);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function">int64 <span class="title">Access</span><span class="params">(Node *pl,Node *pr,<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">			int64 res=(pref[r]-pref[l<span class="number">-1</span>])*(pr-&gt;covc-pl-&gt;covc);</span><br><span class="line">			<span class="keyword">if</span>(L==l &amp;&amp; R==r) &#123;</span><br><span class="line">				res+=pr-&gt;sumv-pl-&gt;sumv;<span class="comment">//covc</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">int</span> Mid=(L+R)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">				<span class="keyword">if</span>(r&lt;=Mid) &#123;</span><br><span class="line">					res+=Access(pl-&gt;son[<span class="number">0</span>],pr-&gt;son[<span class="number">0</span>],L,Mid,l,r);</span><br><span class="line">				&#125; <span class="keyword">else</span> <span class="keyword">if</span>(Mid+<span class="number">1</span>&lt;=l) &#123;</span><br><span class="line">					res+=Access(pl-&gt;son[<span class="number">1</span>],pr-&gt;son[<span class="number">1</span>],Mid+<span class="number">1</span>,R,l,r);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					res+=Access(pl-&gt;son[<span class="number">0</span>],pr-&gt;son[<span class="number">0</span>],L,Mid,l,Mid)+Access(pl-&gt;son[<span class="number">1</span>],pr-&gt;son[<span class="number">1</span>],Mid+<span class="number">1</span>,R,Mid+<span class="number">1</span>,r);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> res;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;<span class="keyword">using</span> segtree::SegTree;</span><br><span class="line">SegTree seg;</span><br><span class="line"><span class="keyword">int</span> fa[MAXN],dep[MAXN],sz[MAXN],prefer[MAXN],cht[MAXN],dfn[MAXN],dfs[MAXN],dc,total[MAXN];</span><br><span class="line">int64 len[MAXN],cpfLen[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">	sz[pos]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(Edge *e=G[pos];e;e=e-&gt;pre) <span class="keyword">if</span>(e-&gt;to!=fa[pos]) &#123;</span><br><span class="line">		<span class="keyword">int</span> u=e-&gt;to;</span><br><span class="line">		len[u]=len[pos]+e-&gt;v;</span><br><span class="line">		fa[u]=pos;</span><br><span class="line">		dep[u]=dep[pos]+<span class="number">1</span>;</span><br><span class="line">		DFS(u);</span><br><span class="line">		sz[pos]+=sz[u];</span><br><span class="line">		prefer[pos]=sz[u]&gt;sz[prefer[pos]]?u:prefer[pos];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Assign</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">	dfs[dfn[pos]=++dc]=pos;</span><br><span class="line">	<span class="keyword">if</span>(prefer[pos]) &#123;</span><br><span class="line">		cht[prefer[pos]]=cht[pos];Assign(prefer[pos]);</span><br><span class="line">		<span class="keyword">for</span>(Edge *e=G[pos];e;e=e-&gt;pre) <span class="keyword">if</span>(e-&gt;to!=fa[pos] &amp;&amp; e-&gt;to!=prefer[pos]) &#123;</span><br><span class="line">			<span class="keyword">int</span> u=e-&gt;to;</span><br><span class="line">			cht[u]=u;</span><br><span class="line">			Assign(u);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Divide</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	dep[<span class="number">1</span>]=<span class="number">1</span>;DFS(<span class="number">1</span>);</span><br><span class="line">	cht[<span class="number">1</span>]=<span class="number">1</span>;Assign(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">new</span>(&amp;seg) SegTree(nc,<span class="number">1</span>,dc);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=dc;++i) &#123;</span><br><span class="line">		pref[i]=pref[i<span class="number">-1</span>]+len[dfs[i]]-len[fa[dfs[i]]];</span><br><span class="line">		cpfLen[a[i]]+=len[i];</span><br><span class="line">	&#125;</span><br><span class="line">	partial_sum(cpfLen+<span class="number">1</span>,cpfLen+<span class="number">1</span>+nc,cpfLen+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Modify</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> color=a[pos];</span><br><span class="line">	<span class="keyword">while</span>(pos) &#123;</span><br><span class="line">		seg.Add(color,dfn[cht[pos]],dfn[pos]);<span class="comment">//把路径上的边都覆盖一下</span></span><br><span class="line">		pos=fa[cht[pos]];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">int64 <span class="title">Query</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> cl,<span class="keyword">int</span> cr)</span> </span>&#123;</span><br><span class="line">	int64 res=(int64)(total[cr]-total[cl<span class="number">-1</span>])*len[pos]+cpfLen[cr]-cpfLen[cl<span class="number">-1</span>];<span class="comment">//total[]</span></span><br><span class="line">	<span class="keyword">while</span>(pos) &#123;</span><br><span class="line">		res-=seg.Sum(cl,cr,dfn[cht[pos]],dfn[pos])&lt;&lt;<span class="number">1</span>;<span class="comment">//统计路径上覆盖的边权和(可以重复)</span></span><br><span class="line">		pos=fa[cht[pos]];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//	freopen("input","r",stdin);</span></span><br><span class="line">	<span class="keyword">int</span> n,Q,A;is&gt;&gt;n&gt;&gt;Q&gt;&gt;A;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		is&gt;&gt;a[i];</span><br><span class="line">		nums[i]=a[i];</span><br><span class="line">	&#125;</span><br><span class="line">	sort(nums+<span class="number">1</span>,nums+<span class="number">1</span>+n);</span><br><span class="line">	nc=unique(nums+<span class="number">1</span>,nums+<span class="number">1</span>+n)-nums<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		a[i]=lower_bound(nums+<span class="number">1</span>,nums+<span class="number">1</span>+nc,a[i])-nums;<span class="comment">//+nc</span></span><br><span class="line">		order[i]=i;</span><br><span class="line">		total[a[i]]++;</span><br><span class="line">	&#125;</span><br><span class="line">	partial_sum(total+<span class="number">1</span>,total+<span class="number">1</span>+n,total+<span class="number">1</span>);</span><br><span class="line">	sort(order+<span class="number">1</span>,order+<span class="number">1</span>+n,CompareValue);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;++i) &#123;</span><br><span class="line">		<span class="keyword">int</span> a,b,c;is&gt;&gt;a&gt;&gt;b&gt;&gt;c;</span><br><span class="line">		Adde(a,b,c);</span><br><span class="line">	&#125;</span><br><span class="line">	Divide();</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		Modify(order[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	int64 last=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=Q;++i) &#123;</span><br><span class="line">		<span class="keyword">int</span> x;int64 a,b,l,r;is&gt;&gt;x&gt;&gt;a&gt;&gt;b;</span><br><span class="line">		l=min((a+last)%A,(b+last)%A);</span><br><span class="line">		r=max((a+last)%A,(b+last)%A);</span><br><span class="line">		last=Query(x,lower_bound(nums+<span class="number">1</span>,nums+<span class="number">1</span>+nc,l)-nums,upper_bound(nums+<span class="number">1</span>,nums+<span class="number">1</span>+nc,r)-nums<span class="number">-1</span>);</span><br><span class="line">		os&lt;&lt;last&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Solution-点分治"><a href="#Solution-点分治" class="headerlink" title="Solution 点分治"></a>Solution 点分治</h1><p>这个做法比较显然，保留分治结构，用vector记录按照颜色排序之后的前缀和。查询时二分查找。
时间<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><msup><mi>log</mi><mn>2</mn></msup><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n\log^2n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>，空间<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>。然而常数非常大</p>
<h2 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"lucida"</span></span></span><br><span class="line"><span class="keyword">import</span> max;</span><br><span class="line"><span class="keyword">import</span> sort;</span><br><span class="line"><span class="keyword">import</span> swap;</span><br><span class="line"><span class="keyword">import</span> pair;</span><br><span class="line"><span class="keyword">import</span> unique;</span><br><span class="line"><span class="keyword">import</span> upper_bound;</span><br><span class="line"><span class="keyword">import</span> lower_bound;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN=<span class="number">150000</span>+<span class="number">11</span>,MAXLOG=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">int</span> nums[MAXN],nc,a[MAXN];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to,v;Edge *pre;</span><br><span class="line">	Edge(<span class="keyword">int</span> to,<span class="keyword">int</span> v,Edge *pre):to(to),v(v),pre(pre) &#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="keyword">size_t</span>)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">static</span> Edge *Me=alloc(Edge,MAXN&lt;&lt;<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> Me++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;*G[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Adde</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">	G[f]=<span class="keyword">new</span> Edge(t,v,G[f]);</span><br><span class="line">	G[t]=<span class="keyword">new</span> Edge(f,v,G[t]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> lca &#123;</span><br><span class="line">	<span class="keyword">int</span> dep[MAXN],stdfs[MAXN&lt;&lt;<span class="number">1</span>],stdc,stdfn[MAXN&lt;&lt;<span class="number">1</span>],st[MAXLOG][MAXN&lt;&lt;<span class="number">1</span>],log_2[MAXN&lt;&lt;<span class="number">1</span>];int64 len[MAXN];</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">		stdfs[stdfn[pos]=++stdc]=pos;</span><br><span class="line">		<span class="keyword">for</span>(Edge *e=G[pos];e;e=e-&gt;pre) <span class="keyword">if</span>(!stdfn[e-&gt;to]) &#123;</span><br><span class="line">			dep[e-&gt;to]=dep[pos]+<span class="number">1</span>;</span><br><span class="line">			len[e-&gt;to]=len[pos]+e-&gt;v;</span><br><span class="line">			DFS(e-&gt;to);</span><br><span class="line">			stdfs[++stdc]=pos;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		DFS(<span class="number">1</span>);</span><br><span class="line">		log_2[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=stdc;++i) &#123;</span><br><span class="line">			st[<span class="number">0</span>][i]=stdfs[i];</span><br><span class="line">			log_2[i]=log_2[i&gt;&gt;<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> pl,pr,lg=<span class="number">1</span>;lg&lt;=log_2[stdc];++lg) &#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=stdc-(<span class="number">1</span>&lt;&lt;lg)+<span class="number">1</span>;++i) &#123;</span><br><span class="line">				st[lg][i]=dep[pl=st[lg<span class="number">-1</span>][i]]&lt;dep[pr=st[lg<span class="number">-1</span>][i+(<span class="number">1</span>&lt;&lt;(lg<span class="number">-1</span>))]]?pl:pr;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> p1,<span class="keyword">int</span> p2)</span> </span>&#123;</span><br><span class="line">		p1=stdfn[p1],p2=stdfn[p2];</span><br><span class="line">		<span class="keyword">if</span>(p1&gt;p2) &#123;</span><br><span class="line">			swap(p1,p2);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> lg=log_2[p2-p1+<span class="number">1</span>],pl=st[lg][p1],pr=st[lg][p2-(<span class="number">1</span>&lt;&lt;lg)+<span class="number">1</span>];</span><br><span class="line">		<span class="keyword">return</span> dep[pl]&lt;dep[pr]?pl:pr;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">int64 <span class="title">Dist</span><span class="params">(<span class="keyword">int</span> p1,<span class="keyword">int</span> p2)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> lca=LCA(p1,p2);</span><br><span class="line">		<span class="keyword">return</span> len[p1]+len[p2]<span class="number">-2</span>*len[lca];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;<span class="keyword">using</span> lca::Dist;	</span><br><span class="line"><span class="keyword">namespace</span> dc &#123;</span><br><span class="line">	<span class="comment">//分治完了之后，保存分治结构</span></span><br><span class="line">	<span class="comment">//在每个重心，记录下方的点，按照颜色排序，并且计算到这个点的距离的前缀和 用vector 空间? n log n</span></span><br><span class="line">	<span class="comment">//查询?</span></span><br><span class="line">	<span class="comment">//从该点沿着分治结构向上走，记录路径长度，另一段乘上个数 加上去</span></span><br><span class="line">	<span class="keyword">int</span> sz[MAXN],tol;</span><br><span class="line">	<span class="keyword">bool</span> ud[MAXN];</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">GetSize</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> from)</span> </span>&#123;</span><br><span class="line">		sz[pos]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span>(Edge *e=G[pos];e;e=e-&gt;pre) <span class="keyword">if</span>(!ud[e-&gt;to] &amp;&amp; e-&gt;to!=from) &#123;</span><br><span class="line">			<span class="keyword">int</span> u=e-&gt;to;</span><br><span class="line">			GetSize(u,pos);</span><br><span class="line">			sz[pos]+=sz[u];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">DP</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> from)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">static</span> <span class="keyword">int</span> f[MAXN]=&#123;INT_MAX&#125;;</span><br><span class="line">		<span class="keyword">int</span> res=<span class="number">0</span>,mxs=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(Edge *e=G[pos];e;e=e-&gt;pre) <span class="keyword">if</span>(!ud[e-&gt;to] &amp;&amp; e-&gt;to!=from) &#123;</span><br><span class="line">			<span class="keyword">int</span> u=e-&gt;to;</span><br><span class="line">			<span class="keyword">int</span> temp=DP(u,pos);</span><br><span class="line">			res=f[res]&lt;f[temp]?res:temp;</span><br><span class="line">			chkmx(mxs,sz[u]);</span><br><span class="line">		&#125;</span><br><span class="line">		f[pos]=max(mxs,tol-sz[pos]);</span><br><span class="line">		<span class="keyword">return</span> f[pos]&lt;f[res]?pos:res;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">Center</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">		GetSize(rt,<span class="number">0</span>);</span><br><span class="line">		tol=sz[rt];</span><br><span class="line">		<span class="keyword">return</span> DP(rt,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">		<span class="keyword">int</span> color;</span><br><span class="line">		int64 sum;</span><br><span class="line">		Node(<span class="keyword">int</span> color,int64 sum):color(color),sum(sum) &#123;&#125;</span><br><span class="line">		<span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> Node &amp;a,<span class="keyword">const</span> Node &amp;b) &#123;</span><br><span class="line">			<span class="keyword">return</span> a.color&lt;b.color;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">array</span>&lt;Node&gt; path[MAXN],anti[MAXN];<span class="keyword">int</span> uplayer[MAXN];</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> from,int64 dist,<span class="built_in">array</span>&lt;Node&gt; &amp;arr)</span> </span>&#123;</span><br><span class="line">		arr.push_back(Node(a[pos],dist));</span><br><span class="line">		<span class="keyword">for</span>(Edge *e=G[pos];e;e=e-&gt;pre) <span class="keyword">if</span>(!ud[e-&gt;to] &amp;&amp; e-&gt;to!=from) &#123;</span><br><span class="line">			<span class="keyword">int</span> u=e-&gt;to;</span><br><span class="line">			DFS(u,pos,dist+e-&gt;v,arr);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">DC</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">		ud[pos]=<span class="number">1</span>;</span><br><span class="line">		path[pos].push_back(Node(a[pos],<span class="number">0</span>));<span class="comment">//..</span></span><br><span class="line">		<span class="keyword">for</span>(Edge *e=G[pos];e;e=e-&gt;pre) <span class="keyword">if</span>(!ud[e-&gt;to]) &#123;</span><br><span class="line">			<span class="keyword">int</span> u=e-&gt;to,gcu=Center(u);</span><br><span class="line">			DFS(u,pos,e-&gt;v,anti[gcu]);</span><br><span class="line">			uplayer[gcu]=pos;</span><br><span class="line">			path[pos].insert(path[pos].end(),anti[gcu].begin(),anti[gcu].end());</span><br><span class="line">			sort(anti[gcu].begin(),anti[gcu].end());</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>,ei=anti[gcu].size();i&lt;ei;++i) &#123;<span class="comment">//i=1?????</span></span><br><span class="line">				anti[gcu][i].sum+=anti[gcu][i<span class="number">-1</span>].sum;</span><br><span class="line">			&#125;</span><br><span class="line">			DC(gcu);</span><br><span class="line">		&#125;</span><br><span class="line">		sort(path[pos].begin(),path[pos].end());</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>,ei=path[pos].size();i&lt;ei;++i) &#123;</span><br><span class="line">			path[pos][i].sum+=path[pos][i<span class="number">-1</span>].sum;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		DC(Center(<span class="number">1</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	pair&lt;int64,<span class="keyword">int</span>&gt; Calc(<span class="built_in">array</span>&lt;Node&gt; &amp;ar,<span class="keyword">int</span> l,<span class="keyword">int</span> r) &#123;</span><br><span class="line">		<span class="keyword">int</span> pl=lower_bound(ar.begin(),ar.end(),Node(l,<span class="number">0</span>))-ar.begin(),</span><br><span class="line">			pr=upper_bound(ar.begin(),ar.end(),Node(r,<span class="number">0</span>))-ar.begin()<span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">return</span> pl!=(<span class="keyword">int</span>)ar.size() &amp;&amp; ~pr?pair&lt;int64,<span class="keyword">int</span>&gt;(ar[pr].sum-(pl?ar[pl<span class="number">-1</span>].sum:<span class="number">0</span>),pr-pl+<span class="number">1</span>):pair&lt;int64,<span class="keyword">int</span>&gt;(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">int64 <span class="title">Query</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">		int64 res=Calc(path[pos],l,r).first;<span class="keyword">int</span> s=pos;</span><br><span class="line">		<span class="keyword">while</span>(uplayer[pos]) &#123;</span><br><span class="line">			pair&lt;int64,<span class="keyword">int</span>&gt; cur=Calc(path[uplayer[pos]],l,r),ant=Calc(anti[pos],l,r);</span><br><span class="line">			res+=cur.first-ant.first+(cur.second-ant.second)*Dist(s,uplayer[pos]);</span><br><span class="line">			pos=uplayer[pos];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;<span class="keyword">using</span> dc::Run;<span class="keyword">using</span> dc::Query;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//	freopen("input","r",stdin);</span></span><br><span class="line">	<span class="keyword">int</span> n,Q,A;is&gt;&gt;n&gt;&gt;Q&gt;&gt;A;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		is&gt;&gt;a[i];</span><br><span class="line">		nums[i]=a[i];</span><br><span class="line">	&#125;</span><br><span class="line">	sort(nums+<span class="number">1</span>,nums+<span class="number">1</span>+n);</span><br><span class="line">	nc=unique(nums+<span class="number">1</span>,nums+<span class="number">1</span>+n)-nums<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		a[i]=lower_bound(nums+<span class="number">1</span>,nums+<span class="number">1</span>+nc,a[i])-nums;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;++i) &#123;</span><br><span class="line">		<span class="keyword">int</span> a,b,c;is&gt;&gt;a&gt;&gt;b&gt;&gt;c;</span><br><span class="line">		Adde(a,b,c);</span><br><span class="line">	&#125;</span><br><span class="line">	lca::Init();</span><br><span class="line">	dc::Run();</span><br><span class="line">	int64 last=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=Q;++i) &#123;</span><br><span class="line">		<span class="keyword">int</span> x;int64 a,b,l,r;is&gt;&gt;x&gt;&gt;a&gt;&gt;b;</span><br><span class="line">		l=(a+last)%A;r=(b+last)%A;</span><br><span class="line">		a=l&lt;r?l:r;b=l&lt;r?r:l;</span><br><span class="line">		l=a;r=b;</span><br><span class="line">		last=Query(x,lower_bound(nums+<span class="number">1</span>,nums+<span class="number">1</span>+nc,l)-nums,upper_bound(nums+<span class="number">1</span>,nums+<span class="number">1</span>+nc,r)-nums<span class="number">-1</span>);</span><br><span class="line">		os&lt;&lt;last&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lucida.site/BZOJ4336/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucida">
      <meta itemprop="description" content="It's been a while.">
      <meta itemprop="image" content="/images/luz.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey,Lucida is back.">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/BZOJ4336/" itemprop="url">
                  BZOJ 4336 骑士的旅行
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-04-04 00:00:00" itemprop="dateCreated datePublished" datetime="2017-04-04T00:00:00+08:00">2017-04-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-06-18 18:23:51" itemprop="dateModified" datetime="2018-06-18T18:23:51+08:00">2018-06-18</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Link"><a href="#Link" class="headerlink" title="Link"></a><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=4336" target="_blank" rel="noopener">Link</a></h1><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>想了一种可持久化可并堆的做法，感觉空间要炸
再仔细想想：
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>K</mi><mo>≤</mo><mn>2</mn><mn>0</mn></mrow><annotation encoding="application/x-tex">1\le K\le 20</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.8193em;vertical-align:-0.13597em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span><span class="mrel">≤</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mrel">≤</span><span class="mord mathrm">2</span><span class="mord mathrm">0</span></span></span></span>MDZZ!!</p>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"lucida"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::swap;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN=<span class="number">40000</span>+<span class="number">11</span>,MAXV=<span class="number">1000</span>,MAXLOG=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">int</span> log_2[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> _&#123;</span>_()&#123;</span><br><span class="line">	log_2[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;(MAXN&lt;&lt;<span class="number">1</span>);++i) &#123;</span><br><span class="line">		log_2[i]=log_2[i&gt;&gt;<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;&#125;Auto;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to;Edge *pre;</span><br><span class="line">	Edge(<span class="keyword">int</span> to,Edge *pre):to(to),pre(pre) &#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="keyword">size_t</span>)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">static</span> Edge *Me=alloc(Edge,MAXN&lt;&lt;<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> Me++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;*G[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Adde</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	G[f]=<span class="keyword">new</span> Edge(t,G[f]);</span><br><span class="line">	G[t]=<span class="keyword">new</span> Edge(f,G[t]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> force[MAXN],place[MAXN];</span><br><span class="line"><span class="keyword">namespace</span> segtree &#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">int</span> SIZE=MAXN*MAXLOG*MAXLOG;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">null</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">		Node *son[<span class="number">2</span>];</span><br><span class="line">		<span class="keyword">int</span> cnt;</span><br><span class="line">		Node():cnt(<span class="number">0</span>) &#123;</span><br><span class="line">			son[<span class="number">0</span>]=son[<span class="number">1</span>]=null;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="keyword">size_t</span>)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">static</span> Node *Me=alloc(Node,SIZE);</span><br><span class="line">			<span class="keyword">return</span> Me++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">Up</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			cnt=son[<span class="number">0</span>]-&gt;cnt+son[<span class="number">1</span>]-&gt;cnt;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;*_null=null=<span class="keyword">new</span> Node,*_null_son=null-&gt;son[<span class="number">0</span>]=null-&gt;son[<span class="number">1</span>]=null;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">SegTree</span> &#123;</span></span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		<span class="keyword">typedef</span> Node *Iter;</span><br><span class="line">		Node *root;</span><br><span class="line">		SegTree() &#123;&#125;</span><br><span class="line">		SegTree(<span class="keyword">int</span> L,<span class="keyword">int</span> R):root(null),L(L),R(R) &#123;&#125;</span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">			Edit(root,L,R,pos,v);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">		<span class="keyword">int</span> L,R;</span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">Edit</span><span class="params">(Node *&amp;pos,<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> goal,<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">			pos=pos==null?<span class="keyword">new</span> Node:pos;</span><br><span class="line">			<span class="keyword">if</span>(L==R) &#123;</span><br><span class="line">				pos-&gt;cnt+=v;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">int</span> Mid=(L+R)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">				goal&lt;=Mid?Edit(pos-&gt;son[<span class="number">0</span>],L,Mid,goal,v):Edit(pos-&gt;son[<span class="number">1</span>],Mid+<span class="number">1</span>,R,goal,v);</span><br><span class="line">				pos-&gt;Up();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;<span class="keyword">using</span> segtree::SegTree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> stdfs[MAXN&lt;&lt;<span class="number">1</span>],stdc,stdfn[MAXN],st[MAXLOG][MAXN&lt;&lt;<span class="number">1</span>],dep[MAXN],fa[MAXN],lbd[MAXN],rbd[MAXN],dfs[MAXN],dc;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ST</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=stdc;++i) &#123;</span><br><span class="line">		st[<span class="number">0</span>][i]=stdfs[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> lg=<span class="number">1</span>;lg&lt;=log_2[stdc];++lg) &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=stdc-(<span class="number">1</span>&lt;&lt;lg)+<span class="number">1</span>;++i) &#123;</span><br><span class="line">			<span class="keyword">int</span> pl=st[lg<span class="number">-1</span>][i],pr=st[lg<span class="number">-1</span>][i+(<span class="number">1</span>&lt;&lt;(lg<span class="number">-1</span>))];</span><br><span class="line">			st[lg][i]=dep[pl]&lt;dep[pr]?pl:pr;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> p1,<span class="keyword">int</span> p2)</span> </span>&#123;</span><br><span class="line">	p1=stdfn[p1],p2=stdfn[p2];</span><br><span class="line">	<span class="keyword">if</span>(p1&gt;p2) &#123;</span><br><span class="line">		swap(p1,p2);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> lg=log_2[p2-p1+<span class="number">1</span>],pl=st[lg][p1],pr=st[lg][p2-(<span class="number">1</span>&lt;&lt;lg)+<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">return</span> dep[pl]&lt;dep[pr]?pl:pr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">	stdfs[stdfn[pos]=++stdc]=pos;</span><br><span class="line">	dfs[lbd[pos]=++dc]=pos;</span><br><span class="line">	<span class="keyword">for</span>(Edge *e=G[pos];e;e=e-&gt;pre) <span class="keyword">if</span>(e-&gt;to!=fa[pos]) &#123;</span><br><span class="line">		<span class="keyword">int</span> u=e-&gt;to;</span><br><span class="line">		fa[u]=pos;</span><br><span class="line">		dep[u]=dep[pos]+<span class="number">1</span>;</span><br><span class="line">		DFS(u);</span><br><span class="line">		stdfs[++stdc]=pos;</span><br><span class="line">	&#125;</span><br><span class="line">	rbd[pos]=dc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bit</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	Bit() &#123;&#125;</span><br><span class="line">	Bit(<span class="keyword">int</span> n):seg(alloc(SegTree,n+<span class="number">1</span>)),n(n) &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=n;++i) &#123;</span><br><span class="line">			<span class="keyword">new</span>(&amp;seg[i]) SegTree(<span class="number">1</span>,MAXV);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">Kiss</span><span class="params">(<span class="keyword">int</span> p1,<span class="keyword">int</span> p2,<span class="keyword">int</span> K)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">static</span> SegTree::Iter plus[MAXN],minus[MAXN];</span><br><span class="line">		<span class="keyword">int</span> lca=LCA(p1,p2);</span><br><span class="line">		<span class="keyword">int</span> plc=FindNode(lbd[p1],plus);</span><br><span class="line">		plc+=FindNode(lbd[p2],plus+plc);</span><br><span class="line">		<span class="keyword">int</span> mnc=FindNode(lbd[lca],minus);</span><br><span class="line">		mnc+=FindNode(lbd[fa[lca]],minus+mnc);</span><br><span class="line">		<span class="keyword">int</span> tol=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=plc;++i) &#123;</span><br><span class="line">			tol+=plus[i]-&gt;cnt;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=mnc;++i) &#123;</span><br><span class="line">			tol-=minus[i]-&gt;cnt;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(tol&lt;K) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> L=<span class="number">1</span>,R=MAXV;<span class="comment">//1.</span></span><br><span class="line">		<span class="keyword">while</span>(L!=R) &#123;</span><br><span class="line">			<span class="keyword">int</span> tol=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=plc;++i) &#123;</span><br><span class="line">				tol+=plus[i]-&gt;son[<span class="number">1</span>]-&gt;cnt;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=mnc;++i) &#123;</span><br><span class="line">				tol-=minus[i]-&gt;son[<span class="number">1</span>]-&gt;cnt;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">int</span> dir=K&lt;=tol;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=plc;++i) &#123;</span><br><span class="line">				plus[i]=plus[i]-&gt;son[dir];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=mnc;++i) &#123;</span><br><span class="line">				minus[i]=minus[i]-&gt;son[dir];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">int</span> Mid=(L+R)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span>(K&lt;=tol) &#123;</span><br><span class="line">				L=Mid+<span class="number">1</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				R=Mid;</span><br><span class="line">				K-=tol;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> L;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> val,<span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=pos;i&lt;=n;i+=i &amp; -i) &#123;</span><br><span class="line">			seg[i].Add(val,d);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	SegTree *seg;<span class="keyword">int</span> n;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">FindNode</span><span class="params">(<span class="keyword">int</span> pos,SegTree::Iter nodes[])</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=pos;i;i-=i &amp; -i) &#123;</span><br><span class="line">			nodes[++cnt]=seg[i].root;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> cnt;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;bit;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	DFS(<span class="number">1</span>);</span><br><span class="line">	ST();</span><br><span class="line">	<span class="keyword">new</span>(&amp;bit) Bit(dc);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Modify</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">	bit.Add(lbd[place[x]],force[x],<span class="number">-1</span>);</span><br><span class="line">	bit.Add(rbd[place[x]]+<span class="number">1</span>,force[x],<span class="number">1</span>);</span><br><span class="line">	bit.Add(lbd[place[x]],force[x]=y,<span class="number">1</span>);</span><br><span class="line">	bit.Add(rbd[place[x]]+<span class="number">1</span>,force[x],<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Move</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">	bit.Add(lbd[place[x]],force[x],<span class="number">-1</span>);</span><br><span class="line">	bit.Add(rbd[place[x]]+<span class="number">1</span>,force[x],<span class="number">1</span>);</span><br><span class="line">	bit.Add(lbd[place[x]=to],force[x],<span class="number">1</span>);</span><br><span class="line">	bit.Add(rbd[place[x]]+<span class="number">1</span>,force[x],<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Query</span><span class="params">(<span class="keyword">int</span> p1,<span class="keyword">int</span> p2,<span class="keyword">int</span> K,<span class="keyword">int</span> Ans[])</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=K;++i) &#123;</span><br><span class="line">		<span class="keyword">if</span>((Ans[++cnt]=bit.Kiss(p1,p2,i))==<span class="number">-1</span>) &#123;</span><br><span class="line">			cnt--;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//	freopen("input","r",stdin);;</span></span><br><span class="line">	<span class="keyword">int</span> n;is&gt;&gt;n;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;++i) &#123;</span><br><span class="line">		<span class="keyword">int</span> x,y;is&gt;&gt;x&gt;&gt;y;</span><br><span class="line">		Adde(x,y);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> m;is&gt;&gt;m;</span><br><span class="line">	Init();</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;++i) &#123;</span><br><span class="line">		is&gt;&gt;force[i]&gt;&gt;place[i];</span><br><span class="line">		bit.Add(lbd[place[i]],force[i],<span class="number">1</span>); </span><br><span class="line">		bit.Add(rbd[place[i]]+<span class="number">1</span>,force[i],<span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> Q,K;is&gt;&gt;Q&gt;&gt;K;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> Ans[<span class="number">30</span>],ac;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=Q;++i) &#123;</span><br><span class="line">		<span class="keyword">int</span> opt,x,y;is&gt;&gt;opt&gt;&gt;x&gt;&gt;y;</span><br><span class="line">		<span class="keyword">switch</span>(opt) &#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">				<span class="keyword">if</span>(!(ac=Query(x,y,K,Ans))) &#123;</span><br><span class="line">					os&lt;&lt;<span class="number">-1</span>&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=ac;++i) &#123;</span><br><span class="line">						os&lt;&lt;Ans[i]&lt;&lt;<span class="string">' '</span>;<span class="comment">//&lt;&lt;(i==ac?'\n':' ');</span></span><br><span class="line">					&#125;</span><br><span class="line">					os&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">				Move(x,y);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">				Modify(x,y);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lucida.site/BZOJ4009/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucida">
      <meta itemprop="description" content="It's been a while.">
      <meta itemprop="image" content="/images/luz.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey,Lucida is back.">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/BZOJ4009/" itemprop="url">
                  BZOJ 4009 接水果
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-04-04 00:00:00" itemprop="dateCreated datePublished" datetime="2017-04-04T00:00:00+08:00">2017-04-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-06-18 18:23:51" itemprop="dateModified" datetime="2018-06-18T18:23:51+08:00">2018-06-18</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Link"><a href="#Link" class="headerlink" title="Link"></a><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=4009" target="_blank" rel="noopener">Link</a></h1><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>在树上画一画，可以发现路径覆盖的充分必要条件。
二维条件，转化成寻找覆盖一个点的权值第<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.07153em;">K</span></span></span></span>大矩阵的问题。
用整体二分实现</p>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"lucida"</span></span></span><br><span class="line"><span class="keyword">import</span> swap;</span><br><span class="line"><span class="keyword">import</span> sort;</span><br><span class="line"><span class="keyword">import</span> copy;</span><br><span class="line"><span class="keyword">import</span> fill;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN=<span class="number">40000</span>+<span class="number">11</span>,MAXLOG=<span class="number">17</span>;</span><br><span class="line"><span class="keyword">int</span> log_2[MAXN];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> _&#123;</span>_() &#123;</span><br><span class="line">	log_2[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;MAXN;++i) &#123;</span><br><span class="line">		log_2[i]=log_2[i&gt;&gt;<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;&#125;Auto;</span><br><span class="line"><span class="keyword">int</span> Ans[MAXN];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to;Edge *pre;</span><br><span class="line">	Edge(<span class="keyword">int</span> to,Edge *pre):to(to),pre(pre) &#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="keyword">size_t</span>)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">static</span> Edge *Me=alloc(Edge,MAXN&lt;&lt;<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> Me++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;*G[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Adde</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	G[f]=<span class="keyword">new</span> Edge(t,G[f]);</span><br><span class="line">	G[t]=<span class="keyword">new</span> Edge(f,G[t]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> x1,x2,y1,y2,c;</span><br><span class="line">	Matrix() &#123;&#125;</span><br><span class="line">	Matrix(<span class="keyword">int</span> x1,<span class="keyword">int</span> x2,<span class="keyword">int</span> y1,<span class="keyword">int</span> y2,<span class="keyword">int</span> c):x1(x1),x2(x2),y1(y1),y2(y2),c(c) &#123;&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> Matrix &amp;a,<span class="keyword">const</span> Matrix &amp;b) &#123;</span><br><span class="line">		<span class="keyword">return</span> a.c&lt;b.c;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Adjust</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(x1&gt;y1) &#123;</span><br><span class="line">			swap(x1,y1);</span><br><span class="line">			swap(x2,y2);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!(x2&lt;y1)) &#123;</span><br><span class="line">			<span class="keyword">throw</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;mtx[MAXN&lt;&lt;<span class="number">1</span>];<span class="keyword">int</span> mc;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Query</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> x,y,K,id;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> Query &amp;a,<span class="keyword">const</span> Query &amp;b) &#123;</span><br><span class="line">		<span class="keyword">return</span> a.x&lt;b.x;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;q[MAXN];</span><br><span class="line"><span class="comment">//盘子是矩形 水果是点 对于每个点 需要知道覆盖它的权值第K大的矩形!</span></span><br><span class="line"><span class="comment">//合法的矩形 [x1,x2] &amp; [y1,y2] = () ! 只要让[x1,x2]都小就可以了！！</span></span><br><span class="line"><span class="keyword">int</span> par[MAXN][MAXLOG],fa[MAXN],dfs[MAXN],lbd[MAXN],rbd[MAXN],dc,dep[MAXN]=&#123;<span class="number">0</span>,<span class="number">1</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">	par[pos][<span class="number">0</span>]=fa[pos];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> lg=<span class="number">1</span>;lg&lt;=log_2[dep[pos]];++lg) &#123;</span><br><span class="line">		par[pos][lg]=par[par[pos][lg<span class="number">-1</span>]][lg<span class="number">-1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	dfs[lbd[pos]=++dc]=pos;</span><br><span class="line">	<span class="keyword">for</span>(Edge *e=G[pos];e;e=e-&gt;pre) <span class="keyword">if</span>(e-&gt;to!=fa[pos]) &#123;</span><br><span class="line">		<span class="keyword">int</span> u=e-&gt;to;</span><br><span class="line">		fa[u]=pos;</span><br><span class="line">		dep[u]=dep[pos]+<span class="number">1</span>;</span><br><span class="line">		DFS(u);</span><br><span class="line">	&#125;</span><br><span class="line">	rbd[pos]=dc;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Jump</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> lg=log_2[len];~lg;--lg) <span class="keyword">if</span>(len&gt;&gt;lg&amp;<span class="number">1</span>) &#123;</span><br><span class="line">		pos=par[pos][lg];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> pos;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> p1,<span class="keyword">int</span> p2)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(dep[p1]&lt;dep[p2]) &#123;</span><br><span class="line">		swap(p1,p2);</span><br><span class="line">	&#125;</span><br><span class="line">	p1=Jump(p1,dep[p1]-dep[p2]);</span><br><span class="line">	<span class="keyword">if</span>(p1!=p2) &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> lg=log_2[dep[p1]<span class="number">-1</span>];~lg;--lg) <span class="keyword">if</span>(par[p1][lg]!=par[p2][lg]) &#123;  <span class="comment">// -  1 ?</span></span><br><span class="line">			p1=par[p1][lg];p2=par[p2][lg];</span><br><span class="line">		&#125;</span><br><span class="line">		p1=fa[p1];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> p1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Deal</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(lbd[x]&gt;lbd[y]) &#123;</span><br><span class="line">		swap(x,y);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> lca=LCA(x,y);</span><br><span class="line">	<span class="keyword">if</span>(x==lca) &#123;</span><br><span class="line">		<span class="keyword">int</span> sec=Jump(y,dep[y]-dep[x]<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">if</span>(<span class="number">1</span>&lt;=lbd[sec]<span class="number">-1</span>) &#123;</span><br><span class="line">			mtx[++mc]=Matrix(<span class="number">1</span>,lbd[sec]<span class="number">-1</span>,lbd[y],rbd[y],c);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(rbd[sec]+<span class="number">1</span>&lt;=dc) &#123;</span><br><span class="line">			mtx[++mc]=Matrix(rbd[sec]+<span class="number">1</span>,dc,lbd[y],rbd[y],c);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		mtx[++mc]=Matrix(lbd[x],rbd[x],lbd[y],rbd[y],c);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Bit</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> n,us[MAXN],ut,a[MAXN];</span><br><span class="line">	Bit() &#123;&#125;</span><br><span class="line">	Bit(<span class="keyword">int</span> n):n(n),ut(<span class="number">0</span>) &#123;</span><br><span class="line">		fill(us+<span class="number">1</span>,us+<span class="number">1</span>+n,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Reset</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		++ut;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(;pos&lt;=n;pos+=pos &amp; -pos) &#123;</span><br><span class="line">			(a[pos]=us[pos]==ut?a[pos]:(us[pos]=ut,<span class="number">0</span>))+=v;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">		Add(l,v);</span><br><span class="line">		Add(r+<span class="number">1</span>,-v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">At</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(;pos;pos-=pos &amp; -pos) &#123;</span><br><span class="line">			res+=(a[pos]=us[pos]==ut?a[pos]:(us[pos]=ut,<span class="number">0</span>));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Scan</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> x,y1,y2;</span><br><span class="line">	<span class="keyword">bool</span> isLeft;</span><br><span class="line">	Scan() &#123;&#125;</span><br><span class="line">	Scan(<span class="keyword">int</span> x,<span class="keyword">int</span> y1,<span class="keyword">int</span> y2,<span class="keyword">bool</span> isLeft):x(x),y1(y1),y2(y2),isLeft(isLeft) &#123;&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> Scan &amp;a,<span class="keyword">const</span> Scan &amp;b) &#123;</span><br><span class="line">		<span class="keyword">return</span> a.x!=b.x?a.x&lt;b.x:!a.isLeft;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//这次不能再重写了！！</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DC</span><span class="params">(<span class="keyword">int</span> ml,<span class="keyword">int</span> mr,<span class="keyword">int</span> ql,<span class="keyword">int</span> qr)</span> </span>&#123;<span class="comment">//在矩阵[ml,mr]的区间里面，查找询问[ql,qr]的答案.</span></span><br><span class="line"><span class="comment">//需要知道[ql,qr]的每个点，被[ml,mr]的矩阵覆盖了多少次.扫描线?</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> Bit <span class="title">bit</span><span class="params">(dc)</span></span>;</span><br><span class="line">	<span class="keyword">static</span> Scan scan[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line">	<span class="keyword">static</span> Query t[MAXN];</span><br><span class="line">	<span class="keyword">if</span>(ml==mr) &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=ql;i&lt;=qr;++i) &#123;</span><br><span class="line">			Ans[q[i].id]=mtx[ml].c;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">int</span> sc=<span class="number">0</span>,mmid=(ml+mr)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=ml;i&lt;=mmid;++i) &#123;</span><br><span class="line">			scan[++sc]=Scan(mtx[i].x1,mtx[i].y1,mtx[i].y2,<span class="number">1</span>);</span><br><span class="line">			scan[++sc]=Scan(mtx[i].x2+<span class="number">1</span>,mtx[i].y1,mtx[i].y2,<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		sort(scan+<span class="number">1</span>,scan+<span class="number">1</span>+sc);</span><br><span class="line">		sort(q+ql,q+qr+<span class="number">1</span>);</span><br><span class="line">		bit.Reset();</span><br><span class="line">		<span class="keyword">int</span> tl=ql,tr=qr;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=ql,sp=<span class="number">1</span>;i&lt;=qr;++i) &#123;</span><br><span class="line">			<span class="keyword">while</span>(sp&lt;=sc &amp;&amp; scan[sp].x&lt;=q[i].x) &#123;</span><br><span class="line">				bit.Add(scan[sp].y1,scan[sp].y2,scan[sp].isLeft?<span class="number">1</span>:<span class="number">-1</span>);		</span><br><span class="line">				sp++;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">int</span> sum=bit.At(q[i].y);</span><br><span class="line">			<span class="keyword">if</span>(q[i].K&lt;=sum) &#123;</span><br><span class="line">				t[tl++]=q[i];</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				q[i].K-=sum;</span><br><span class="line">				t[tr--]=q[i];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		copy(t+ql,t+qr+<span class="number">1</span>,q+ql);</span><br><span class="line">		DC(ml,mmid,ql,tl<span class="number">-1</span>);</span><br><span class="line">		DC(mmid+<span class="number">1</span>,mr,tr+<span class="number">1</span>,qr);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//	freopen("input","r",stdin);</span></span><br><span class="line">	<span class="keyword">int</span> n,disc,qc;</span><br><span class="line">	is&gt;&gt;n&gt;&gt;disc&gt;&gt;qc;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-1</span>;++i) &#123;</span><br><span class="line">		<span class="keyword">int</span> x,y;is&gt;&gt;x&gt;&gt;y;</span><br><span class="line">		Adde(x,y);</span><br><span class="line">	&#125;</span><br><span class="line">	DFS(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=disc;++i) &#123;</span><br><span class="line">		<span class="keyword">int</span> x,y,c;is&gt;&gt;x&gt;&gt;y&gt;&gt;c;</span><br><span class="line">		Deal(x,y,c);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=mc;++i) &#123;</span><br><span class="line">		mtx[i].Adjust();</span><br><span class="line">	&#125;</span><br><span class="line">	sort(mtx+<span class="number">1</span>,mtx+<span class="number">1</span>+mc);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=qc;++i) &#123;</span><br><span class="line">		is&gt;&gt;q[i].x&gt;&gt;q[i].y&gt;&gt;q[i].K;</span><br><span class="line">		q[i].id=i;</span><br><span class="line">		<span class="keyword">if</span>((q[i].x=lbd[q[i].x])&gt;(q[i].y=lbd[q[i].y])) &#123;</span><br><span class="line">			swap(q[i].x,q[i].y);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	sort(q+<span class="number">1</span>,q+<span class="number">1</span>+qc);</span><br><span class="line">	DC(<span class="number">1</span>,mc,<span class="number">1</span>,qc);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=qc;++i) &#123;</span><br><span class="line">		os&lt;&lt;Ans[i]&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lucida.site/BZOJ4765/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucida">
      <meta itemprop="description" content="It's been a while.">
      <meta itemprop="image" content="/images/luz.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey,Lucida is back.">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/BZOJ4765/" itemprop="url">
                  BZOJ 4765 普通计算姬
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-04-04 00:00:00" itemprop="dateCreated datePublished" datetime="2017-04-04T00:00:00+08:00">2017-04-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-06-18 18:23:51" itemprop="dateModified" datetime="2018-06-18T18:23:51+08:00">2018-06-18</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Link"><a href="#Link" class="headerlink" title="Link"></a><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=4765" target="_blank" rel="noopener">Link</a></h1><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>对<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mn>1</mn><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi>n</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[1..n]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathrm">1</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathit">n</span><span class="mclose">]</span></span></span></span>这个答案序列分块！！为什么我总是想把树分块。。。
想到这，接着就比较好说了。
修改一个点对块的影响，是使得它在块内的祖先的权值都相应变化。块内的祖先个数，可以<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><msqrt><mi>n</mi></msqrt><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n\sqrt n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8002800000000001em;"></span><span class="strut bottom" style="height:1.05028em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="sqrt mord"><span class="sqrt-sign" style="top:0.03971999999999998em;"><span class="style-wrap reset-textstyle textstyle uncramped">√</span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord mathit">n</span></span><span style="top:-0.72028em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span>地预处理出来。
这样整块的统计是<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msqrt><mi>n</mi></msqrt><mo>)</mo></mrow><annotation encoding="application/x-tex">O(\sqrt n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8002800000000001em;"></span><span class="strut bottom" style="height:1.05028em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="sqrt mord"><span class="sqrt-sign" style="top:0.03971999999999998em;"><span class="style-wrap reset-textstyle textstyle uncramped">√</span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord mathit">n</span></span><span style="top:-0.72028em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span>的，那么零碎部分的也尽量<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msqrt><mi>n</mi></msqrt><mo>)</mo></mrow><annotation encoding="application/x-tex">O(\sqrt n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8002800000000001em;"></span><span class="strut bottom" style="height:1.05028em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="sqrt mord"><span class="sqrt-sign" style="top:0.03971999999999998em;"><span class="style-wrap reset-textstyle textstyle uncramped">√</span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord mathit">n</span></span><span style="top:-0.72028em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span>，那就要求每个点的求值是<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span>的。显然常见套路树状数组做不到。
那么再用dfs序分块替代树状数组。同样支持区间修改，询问变成<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span>，修改<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msqrt><mi>n</mi></msqrt><mo>)</mo></mrow><annotation encoding="application/x-tex">O(\sqrt n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8002800000000001em;"></span><span class="strut bottom" style="height:1.05028em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="sqrt mord"><span class="sqrt-sign" style="top:0.03971999999999998em;"><span class="style-wrap reset-textstyle textstyle uncramped">√</span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord mathit">n</span></span><span style="top:-0.72028em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span>。总复杂度就是<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><msqrt><mi>n</mi></msqrt><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n\sqrt n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8002800000000001em;"></span><span class="strut bottom" style="height:1.05028em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="sqrt mord"><span class="sqrt-sign" style="top:0.03971999999999998em;"><span class="style-wrap reset-textstyle textstyle uncramped">√</span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord mathit">n</span></span><span style="top:-0.72028em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span>了。</p>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"lucida"</span></span></span><br><span class="line"><span class="keyword">import</span> copy;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> qword;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN=<span class="number">1e5</span>+<span class="number">11</span>,MAXB=<span class="number">320</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to;Edge *pre;</span><br><span class="line">	Edge(<span class="keyword">int</span> to,Edge *pre):to(to),pre(pre) &#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="keyword">size_t</span>)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">static</span> Edge *Me=alloc(Edge,MAXN&lt;&lt;<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> Me++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;*G[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Adde</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	G[f]=<span class="keyword">new</span> Edge(t,G[f]);</span><br><span class="line">	G[t]=<span class="keyword">new</span> Edge(f,G[t]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//序列分块</span></span><br><span class="line"><span class="keyword">int</span> bsz,bs[MAXN],bt[MAXN],bc,bn[MAXN],parCnt[MAXN][MAXB];</span><br><span class="line">qword bAns[MAXB],pref[MAXN];</span><br><span class="line">int64 a[MAXN],mrk[MAXB];</span><br><span class="line"><span class="keyword">int</span> fa[MAXN],lbd[MAXN],rbd[MAXN],dfs[MAXN],dc;</span><br><span class="line"><span class="function">qword <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> cnt[MAXB];<span class="comment">//存储祖先 每块的个数</span></span><br><span class="line">	qword sum=a[pos];</span><br><span class="line">	cnt[bn[pos]]++;</span><br><span class="line">	dfs[lbd[pos]=++dc]=pos;</span><br><span class="line">	copy(cnt+<span class="number">1</span>,cnt+<span class="number">1</span>+bc,parCnt[pos]+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(Edge *e=G[pos];e;e=e-&gt;pre) <span class="keyword">if</span>(e-&gt;to!=fa[pos]) &#123;</span><br><span class="line">		<span class="keyword">int</span> u=e-&gt;to;</span><br><span class="line">		fa[u]=pos;</span><br><span class="line">		sum+=DFS(u);</span><br><span class="line">	&#125;</span><br><span class="line">	cnt[bn[pos]]--;</span><br><span class="line">	bAns[bn[pos]]+=sum;</span><br><span class="line">	rbd[pos]=dc;</span><br><span class="line">	<span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Change</span><span class="params">(<span class="keyword">int</span> pos,int64 v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> b=<span class="number">1</span>;b&lt;=bc;++b) &#123;</span><br><span class="line">		bAns[b]+=(v-a[pos])*parCnt[pos][b];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> dfn=lbd[pos];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> b=bn[dfn]+<span class="number">1</span>;b&lt;=bc;++b) &#123;</span><br><span class="line">		mrk[b]+=v-a[pos];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=dfn;i&lt;=bt[bn[dfn]];++i) &#123;</span><br><span class="line">		pref[i]+=v-a[pos];</span><br><span class="line">	&#125;</span><br><span class="line">	a[pos]=v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">qword <span class="title">SbtSum</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (pref[rbd[rt]]+mrk[bn[rbd[rt]]])-(pref[lbd[rt]<span class="number">-1</span>]+mrk[bn[lbd[rt]<span class="number">-1</span>]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">qword <span class="title">Query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">	qword res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(bn[l]==bn[r]) &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=l;i&lt;=r;++i) &#123;</span><br><span class="line">			res+=SbtSum(i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> b=bn[l]+<span class="number">1</span>;b&lt;=bn[r]<span class="number">-1</span>;++b) &#123;</span><br><span class="line">			res+=bAns[b];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=l;i&lt;=bt[bn[l]];++i) &#123;</span><br><span class="line">			res+=SbtSum(i);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=bs[bn[r]];i&lt;=r;++i) &#123;</span><br><span class="line">			res+=SbtSum(i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//	freopen("input","r",stdin);</span></span><br><span class="line">	<span class="keyword">int</span> n,m;is&gt;&gt;n&gt;&gt;m;</span><br><span class="line">	bsz=<span class="built_in">sqrt</span>(n+<span class="number">0.5</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		is&gt;&gt;a[i];</span><br><span class="line">		bn[i]=(i<span class="number">-1</span>)/bsz+<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(bn[i]!=bn[i<span class="number">-1</span>]) &#123;</span><br><span class="line">			bs[bn[i]]=i;</span><br><span class="line">			bt[bn[i<span class="number">-1</span>]]=i<span class="number">-1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	bt[bc=bn[n]]=n;</span><br><span class="line">	<span class="keyword">int</span> root;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		<span class="keyword">int</span> x,y;is&gt;&gt;x&gt;&gt;y;</span><br><span class="line">		<span class="keyword">if</span>(x) &#123;</span><br><span class="line">			Adde(x,y);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			root=y;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	DFS(root);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		pref[i]=pref[i<span class="number">-1</span>]+a[dfs[i]];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;++i) &#123;</span><br><span class="line">		<span class="keyword">int</span> op,x,l,r;</span><br><span class="line">		int64 v;</span><br><span class="line">		is&gt;&gt;op;</span><br><span class="line">		<span class="keyword">if</span>(op==<span class="number">1</span>) &#123;</span><br><span class="line">			is&gt;&gt;x&gt;&gt;v;</span><br><span class="line">			Change(x,v);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			is&gt;&gt;l&gt;&gt;r;</span><br><span class="line">			qword Ans=Query(l,r);</span><br><span class="line">			os&lt;&lt;Ans&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lucida.site/BZOJ2851/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucida">
      <meta itemprop="description" content="It's been a while.">
      <meta itemprop="image" content="/images/luz.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey,Lucida is back.">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/BZOJ2851/" itemprop="url">
                  BZOJ 2851 极限满月
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-04-04 00:00:00" itemprop="dateCreated datePublished" datetime="2017-04-04T00:00:00+08:00">2017-04-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-06-18 18:23:51" itemprop="dateModified" datetime="2018-06-18T18:23:51+08:00">2018-06-18</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Link"><a href="#Link" class="headerlink" title="Link"></a><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2851" target="_blank" rel="noopener">Link</a></h1><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>非常神奇的思路。
每个集合<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>B</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">B_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.05017em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>的元素一定是<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>≤</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">\le k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.83041em;vertical-align:-0.13597em;"></span><span class="base textstyle uncramped"><span class="mrel">≤</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>的数字。这些数字，是几个集合求交的得到的。一切集合追溯到本源，都来源于虚无(<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">∅</mi></mrow><annotation encoding="application/x-tex">\emptyset</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:0.80556em;vertical-align:-0.05556em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">∅</span></span></span></span>)。如果把每个集合抽象成到<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">∅</mi></mrow><annotation encoding="application/x-tex">\emptyset</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:0.80556em;vertical-align:-0.05556em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">∅</span></span></span></span>的路径，每个集合的构造过程就是几条路径的并集，加上一个新点。这是一个树结构，然后就可以通过LCA实现求交，通过DFS序实现求并集的大小。</p>
<h1 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h1><p>集合交：路径交
集合并：路径并</p>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"lucida"</span></span></span><br><span class="line"><span class="keyword">import</span> swap;</span><br><span class="line"><span class="keyword">import</span> sort;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN=<span class="number">200000</span>+<span class="number">11</span>,MAXLOG=<span class="number">20</span>;<span class="comment">//儮儈儈儈儈儈</span></span><br><span class="line"><span class="keyword">int</span> log_2[MAXN];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> _&#123;</span>_() &#123;</span><br><span class="line">	log_2[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;MAXN;++i) &#123;</span><br><span class="line">		log_2[i]=log_2[i&gt;&gt;<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;&#125;Auto;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to;Edge *pre;</span><br><span class="line">	Edge(<span class="keyword">int</span> to,Edge *pre):to(to),pre(pre) &#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="keyword">size_t</span>)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">static</span> Edge *Me=alloc(Edge,MAXN);</span><br><span class="line">		<span class="keyword">return</span> Me++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;*G[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Adde</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	G[f]=<span class="keyword">new</span> Edge(t,G[f]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> par[MAXN][MAXLOG],dep[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Link</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">	Adde(fa,pos);</span><br><span class="line">	par[pos][<span class="number">0</span>]=fa;</span><br><span class="line">	dep[pos]=dep[fa]+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> lg=<span class="number">1</span>;lg&lt;=log_2[dep[pos]];++lg) &#123;</span><br><span class="line">		par[pos][lg]=par[par[pos][lg<span class="number">-1</span>]][lg<span class="number">-1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> p1,<span class="keyword">int</span> p2)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (dep[p1]&lt;dep[p2]) &#123;</span><br><span class="line">		swap(p1,p2);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> len=dep[p1]-dep[p2],lg=log_2[len];~lg;--lg) <span class="keyword">if</span>(len&gt;&gt;lg&amp;<span class="number">1</span>) &#123;</span><br><span class="line">		p1=par[p1][lg];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(p1!=p2) &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> lg=log_2[dep[p1]];~lg;--lg) <span class="keyword">if</span>(par[p1][lg]!=par[p2][lg]) &#123;</span><br><span class="line">			p1=par[p1][lg];</span><br><span class="line">			p2=par[p2][lg];</span><br><span class="line">		&#125;</span><br><span class="line">		p1=par[p1][<span class="number">0</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> p1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> dfn[MAXN],dc;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">	dfn[pos]=++dc;</span><br><span class="line">	<span class="keyword">for</span>(Edge *e=G[pos];e;e=e-&gt;pre) &#123;</span><br><span class="line">		<span class="keyword">int</span> u=e-&gt;to;</span><br><span class="line">		DFS(u);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmpDFN</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp;p1,<span class="keyword">const</span> <span class="keyword">int</span> &amp;p2)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> dfn[p1]&lt;dfn[p2];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//	freopen("input","r",stdin);</span></span><br><span class="line">	<span class="comment">//A_i 的元素都比i小</span></span><br><span class="line">	<span class="comment">//B_k 最大的元素一定是k </span></span><br><span class="line">	<span class="keyword">int</span> n;is&gt;&gt;n;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</span><br><span class="line">		<span class="keyword">int</span> lca=<span class="number">-1</span>,cnt;is&gt;&gt;cnt;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=cnt;++j) &#123;</span><br><span class="line">			<span class="keyword">int</span> x;is&gt;&gt;x;</span><br><span class="line">			lca=lca==<span class="number">-1</span>?x:LCA(x,lca);</span><br><span class="line">		&#125;</span><br><span class="line">		Link(i,lca=lca==<span class="number">-1</span>?<span class="number">0</span>:lca);</span><br><span class="line">	&#125;</span><br><span class="line">	DFS(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">int</span> Q;is&gt;&gt;Q;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> rep=<span class="number">1</span>;rep&lt;=Q;++rep) &#123;</span><br><span class="line">		<span class="keyword">int</span> cnt;is&gt;&gt;cnt;</span><br><span class="line">		<span class="keyword">static</span> <span class="keyword">int</span> x[MAXN];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=cnt;++i) &#123;</span><br><span class="line">			is&gt;&gt;x[i];</span><br><span class="line">		&#125;</span><br><span class="line">		sort(x+<span class="number">1</span>,x+<span class="number">1</span>+cnt,cmpDFN);</span><br><span class="line">		<span class="keyword">int</span> Ans=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=cnt<span class="number">-1</span>;++i) &#123;</span><br><span class="line">			Ans+=dep[x[i]]-dep[LCA(x[i],x[i+<span class="number">1</span>])];</span><br><span class="line">		&#125;</span><br><span class="line">		Ans+=dep[x[cnt]];</span><br><span class="line">		os&lt;&lt;Ans&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lucida.site/BZOJ2849/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucida">
      <meta itemprop="description" content="It's been a while.">
      <meta itemprop="image" content="/images/luz.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey,Lucida is back.">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/BZOJ2849/" itemprop="url">
                  BZOJ 2849 和谐串
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-04-04 00:00:00" itemprop="dateCreated datePublished" datetime="2017-04-04T00:00:00+08:00">2017-04-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-06-17 18:00:36" itemprop="dateModified" datetime="2018-06-17T18:00:36+08:00">2018-06-17</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Link"><a href="#Link" class="headerlink" title="Link"></a><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2849" target="_blank" rel="noopener">Link</a></h1><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>显然可以暴力DP。对小范围打表找规律可以得结论。
然后套Wallis公式
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mo>(</mo><mn>2</mn><mi>n</mi><mo>)</mo><mo>!</mo><mo>!</mo></mrow><mrow><mo>(</mo><mn>2</mn><mi>n</mi><mo>−</mo><mn>1</mn><mo>)</mo><mo>!</mo><mo>!</mo></mrow></mfrac><mo>∼</mo><msqrt><mrow><mi>π</mi><mi>n</mi></mrow></msqrt></mrow><annotation encoding="application/x-tex">\dfrac {(2n)!!}{(2n-1)!!}\sim \sqrt{\pi n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.427em;"></span><span class="strut bottom" style="height:2.363em;vertical-align:-0.936em;"></span><span class="base textstyle uncramped"><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mopen">(</span><span class="mord mathrm">2</span><span class="mord mathit">n</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">)</span><span class="mclose">!</span><span class="mclose">!</span></span></span></span><span style="top:-0.2300000000000001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mopen">(</span><span class="mord mathrm">2</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mclose">!</span><span class="mclose">!</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mrel">∼</span><span class="sqrt mord"><span class="sqrt-sign" style="top:0.03971999999999998em;"><span class="style-wrap reset-textstyle textstyle uncramped">√</span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord textstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">π</span><span class="mord mathit">n</span></span></span><span style="top:-0.72028em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span></span></span></span>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mi>n</mi><mi>s</mi><mo>≈</mo><mfrac><mrow><msqrt><mrow><mi>π</mi><mi>n</mi></mrow></msqrt></mrow><mrow><mn>2</mn><mi>n</mi><mo>+</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">Ans\approx\dfrac {\sqrt{\pi n}}{2n+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.4772800000000001em;"></span><span class="strut bottom" style="height:2.2466100000000004em;vertical-align:-0.7693300000000001em;"></span><span class="base textstyle uncramped"><span class="mord mathit">A</span><span class="mord mathit">n</span><span class="mord mathit">s</span><span class="mrel">≈</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathrm">2</span><span class="mord mathit">n</span><span class="mbin">+</span><span class="mord mathrm">1</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="sqrt mord"><span class="sqrt-sign" style="top:0.03971999999999998em;"><span class="style-wrap reset-textstyle textstyle uncramped">√</span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord textstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">π</span><span class="mord mathit">n</span></span></span><span style="top:-0.72028em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></p>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"lucida"</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e7</span>,MAXN=N+<span class="number">11</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> pi=<span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">double</span> Ans[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Prep</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Ans[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=N;++i) &#123;</span><br><span class="line">		Ans[i]=Ans[i<span class="number">-1</span>]/(<span class="number">2</span>*i+<span class="number">1</span>)*<span class="number">2</span>*i;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">Calc</span><span class="params">(int64 n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(n&lt;=N) &#123;</span><br><span class="line">		<span class="keyword">return</span> Ans[n];</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sqrt</span>(pi*n)/(<span class="number">2</span>*n+<span class="number">1</span>); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//	freopen("input","r",stdin);</span></span><br><span class="line">	os.precision(<span class="number">20</span>);</span><br><span class="line">	Prep();</span><br><span class="line">	<span class="keyword">int</span> T;is&gt;&gt;T;</span><br><span class="line">	<span class="keyword">while</span>(T--) &#123;</span><br><span class="line">		int64 n;is&gt;&gt;n;</span><br><span class="line">		os&lt;&lt;Calc(n)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/luz.png"
                alt="Lucida" />
            
              <p class="site-author-name" itemprop="name">Lucida</p>
              <p class="site-description motion-element" itemprop="description">It's been a while.</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">222</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">127</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lucida</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	





  





  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  
    
      <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css" type="text/css">

   
  


  
  

  

  

  

  

  

</body>
</html>
